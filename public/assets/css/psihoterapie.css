
 /* --- MODERN FRESH STYLES START --- */
:root {
    --font-primary: 'Ubuntu', 'Roboto', 'Montserrat', sans-serif;
    --font-secondary: 'Roboto', sans-serif; /* For body text if needed */

    --color-bg-main: #F8F9FA; /* Off-white, very light gray */
    --color-bg-content: #FFFFFF; /* White for cards, forms */
    --color-bg-alt: #E9ECEF; /* Slightly darker gray for accents, inputs */
    --color-bg-chat-alt: #F1F3F5; /* Background for chat input area and AI messages */

    --color-primary: #4A90E2; /* A vibrant, yet calm blue */
    --color-primary-dark: #3A7BC8;
    --color-primary-light: #EAF2FD;

    --color-secondary: #50E3C2; /* A fresh teal/mint */
    --color-secondary-dark: #38B2AC;

    --color-accent: #F5A623; /* A warm accent, e.g., for warnings or highlights */

    --color-text-dark: #212529; /* Very dark gray, near black */
    --color-text-medium: #495057; /* Medium gray */
    --color-text-light: #6C757D; /* Light gray */
    --color-text-inverted: #FFFFFF;

    --color-success: #28A745;
    --color-success-bg: #E9F7EA;
    --color-error: #DC3545;
    --color-error-bg: #FAE8EA;
    --color-warning: #FFC107;
    --color-warning-bg: #FFF9E6;

    --border-radius-small: 4px;
    --border-radius-medium: 8px;
    --border-radius-large: 16px; /* For chat container, main form sections */

    --shadow-light: 0 2px 4px rgba(0, 0, 0, 0.05);
    --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-strong: 0 8px 24px rgba(0,0,0,0.12);

    --spacing-unit: 8px;
}

*, *::before, *::after { box-sizing: border-box; }

body {
    font-family: var(--font-primary);
    margin: 0; padding: calc(var(--spacing-unit) * 3); /* 24px */
    background: var(--color-bg-main);
    color: var(--color-text-medium);
    line-height: 1.65; font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* APP HEADER */
.app-header { text-align: center; margin-bottom: calc(var(--spacing-unit) * 5); /* 40px */ }
.app-header h1 {
    font-size: 2.25em; /* Slightly larger */
    color: var(--color-text-dark);
    margin-bottom: var(--spacing-unit);
    font-weight: 700; /* Bolder */
    letter-spacing: -0.5px;
}
.app-header p { font-size: 1.1em; color: var(--color-text-light); margin-top: 0; font-weight: 300; }

/* TAB NAVIGATION */
.tab-navigation {
    display: flex;
    justify-content: center;
    margin-bottom: calc(var(--spacing-unit) * 4); /* 32px */
    gap: 0; /* Remove gap, use borders for separation */
    border-bottom: 1px solid #dee2e6;
}
.tab-button {
    padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 3); /* 12px 24px */
    font-size: 1.05em; font-weight: 500;
    border: none;
    border-bottom: 3px solid transparent;
    background: none;
    color: var(--color-text-light);
    cursor: pointer;
    transition: color 0.25s ease, border-color 0.25s ease;
    border-radius: 0; /* Remove individual radius */
    margin-bottom: -1px; /* Overlap border-bottom of nav */
}
.tab-button:hover {
    color: var(--color-primary);
}
.tab-button.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    font-weight: 600;
}

/* TAB CONTENT - active handled by JS */

/* FORM SECTION CONTAINER */
.form-section-container {
    max-width: 760px;
    margin: 0 auto calc(var(--spacing-unit) * 5) auto; /* 40px bottom margin */
    background: var(--color-bg-content);
    padding: calc(var(--spacing-unit) * 4) calc(var(--spacing-unit) * 4.5); /* 32px 36px */
    box-shadow: var(--shadow-medium);
    border-radius: var(--border-radius-large);
    border: 1px solid #e0e0e0; /* Subtle border */
}
.form-section-container h2 {
     font-size: 1.75em; margin-bottom: calc(var(--spacing-unit) * 1.5); /* 12px */
     text-align: center; color: var(--color-text-dark); font-weight: 600;
}
.form-section-container > p:not(.confirmation-message) {
    text-align: center; margin-top: calc(var(--spacing-unit) * -0.5); /* -4px */
    margin-bottom: calc(var(--spacing-unit) * 3); /* 24px */
    font-size: 1em; color: var(--color-text-light); font-weight: 300; max-width: 90%; margin-left: auto; margin-right: auto;
}

/* GENERAL FORM ELEMENTS */
label {
    display:block; margin-bottom: var(--spacing-unit); font-weight: 500;
    color: var(--color-text-medium); font-size: 0.9em;
}
input[type="text"], textarea {
    width: 100%; padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 1.75); /* 12px 14px */
    font-size: 1em; font-family: var(--font-secondary);
    border-radius: var(--border-radius-medium); border: 1px solid #CED4DA; /* Lighter border */
    transition: border-color 0.2s, box-shadow 0.2s;
    background-color: var(--color-bg-content); /* White background */
    color: var(--color-text-dark);
}
input[type="text"]::placeholder, textarea::placeholder {
    color: #adb5bd;
    font-weight: 300;
}
input[type="text"]:focus, textarea:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.15); /* Softer focus ring */
    outline: none;
}
textarea {
    resize: vertical; min-height: 100px; line-height: 1.6;
}

/* FIȘĂ FORM */
.progress-bar {
    width: 100%; background-color: var(--color-bg-alt); border-radius: var(--border-radius-small);
    overflow: hidden; margin-bottom: calc(var(--spacing-unit) * 3); /* 24px */ height: 10px; /* Slimmer */
    box-shadow: inset 0 1px 2px rgba(0,0,0,0.07);
}
.progress {
    height: 100%; width: 0; background: linear-gradient(90deg, var(--color-secondary-dark), var(--color-secondary));
    transition: width 0.4s ease; border-radius: var(--border-radius-small);
}
.question-card {
    margin-bottom: calc(var(--spacing-unit) * 3); /* 24px */
    padding: calc(var(--spacing-unit) * 2.5); /* 20px */
    background: #FDFEFF; /* Slightly off-white, lighter than form container */
    border-radius: var(--border-radius-medium);
    border: 1px solid #E7F0F9; /* Very light blueish border */
}
.question-card h3 {
    font-weight: 600; font-size: 1.1em; margin-top: 0;
    margin-bottom: calc(var(--spacing-unit) * 0.75); /* 6px */
    color: var(--color-primary); /* Primary color for titles */
}
.question-card p {
    font-weight: 400; font-size: 0.95em; margin-bottom: calc(var(--spacing-unit) * 1.5); /* 12px */
    color: var(--color-text-medium); line-height: 1.6;
}
.form-step {display: none;} /* JS handles active */
.form-step-active {display: block; animation: fadeInFormStep 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);}
@keyframes fadeInFormStep { 0% {opacity: 0; transform: translateY(15px);} 100% {opacity: 1; transform: translateY(0);} }

.step-navigation {
    text-align: center; margin-top: calc(var(--spacing-unit) * 3.5); /* 28px */
    display: flex; justify-content: space-between; gap:calc(var(--spacing-unit) * 2); /* 16px */
}
.step-navigation button, button#fisaAddButton, button#saveJournalEntryButton {
    padding: calc(var(--spacing-unit) * 1.25) calc(var(--spacing-unit) * 2.5); /* 10px 20px */
    font-family: var(--font-primary); font-size: 0.95em; font-weight: 500;
    color: var(--color-text-inverted); border: none; border-radius: var(--border-radius-medium);
    cursor: pointer; transition: background-color 0.2s, transform 0.15s ease-out, box-shadow 0.2s ease;
    box-shadow: var(--shadow-light);
    letter-spacing: 0.3px;
}
.step-navigation button:hover:not(:disabled), button#fisaAddButton:hover:not(:disabled), button#saveJournalEntryButton:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
}
.step-navigation button#fisaPrevButton { background-color: var(--color-text-light); }
.step-navigation button#fisaPrevButton:hover:not(:disabled) { background-color: #5a6268; }
.step-navigation button#fisaNextButton { background-color: var(--color-primary); }
.step-navigation button#fisaNextButton:hover:not(:disabled) { background-color: var(--color-primary-dark); }

button#fisaAddButton {
    background-color: var(--color-success); display:block; width:100%;
    margin-top:calc(var(--spacing-unit) * 2.5); /* 20px */ font-size: 1em;
}
button#fisaAddButton:hover:not(:disabled) { background-color: #218838; }

.step-navigation button:disabled, button#fisaAddButton:disabled, button#saveJournalEntryButton:disabled {
    background: #ced4da !important; color: #6c757d !important;
    cursor: not-allowed !important; box-shadow: none !important; transform: translateY(0) !important;
}

/* JURNAL FORM */
input#journalTitle {
    margin-bottom: calc(var(--spacing-unit) * 2); /* 16px */
}
textarea#journalContent {
    min-height: 220px; line-height: 1.7; margin-top: var(--spacing-unit);
}

.prompt-box {
    background: var(--color-primary-light); border: 1px solid #B9D7F8;
    border-left: 4px solid var(--color-primary);
    padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2); /* 12px 16px */
    margin-bottom: calc(var(--spacing-unit) * 2); /* 16px */
    font-size: 0.9em; border-radius: var(--border-radius-medium);
}
.prompt-box-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: var(--spacing-unit);
}
.prompt-box-header strong { color: var(--color-primary-dark); font-size: 1.1em; font-weight: 600;}
.hide-prompt-button {
    background: none; border: none; color: var(--color-primary);
    font-size: 1.8em; font-weight: bold; cursor: pointer;
    padding: 0 calc(var(--spacing-unit) * 0.5); /* 0 4px */
    line-height: 0.8; opacity: 0.7; transition: opacity 0.2s;
}
.hide-prompt-button:hover { opacity: 1; }

.prompt-content-display {
    white-space: pre-wrap; max-height: 200px; overflow-y: auto;
    background-color: var(--color-bg-content);
    padding: calc(var(--spacing-unit) * 1.25); /* 10px */
    border-radius: var(--border-radius-small); border: 1px solid #DDE8F5;
    font-family: 'Menlo', 'Monaco', monospace; font-size:0.9em; line-height: 1.5;
    color: var(--color-text-medium);
}
.prompt-content-display::-webkit-scrollbar { width: 6px; }
.prompt-content-display::-webkit-scrollbar-track { background: #f1f1f1; }
.prompt-content-display::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius:3px; }
.prompt-content-display::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }

#reflectionPromptsContainer {
    margin: calc(var(--spacing-unit) * 2.5) 0; /* 20px 0 */
    padding: calc(var(--spacing-unit) * 2); /* 16px */
    background-color: var(--color-bg-main); /* Match body BG for less contrast here */
    border-radius: var(--border-radius-medium);
    border: 1px solid #E0E6ED;
}
#reflectionPromptsContainer p {
    margin-top: 0; margin-bottom: var(--spacing-unit); font-weight: 500;
    color: var(--color-text-dark); font-size: 0.95em;
}
.prompt-button-group { display: flex; flex-wrap: wrap; gap: var(--spacing-unit); /* 8px */ }
button.prompt-button {
    background-color: transparent; /* Changed */
    color: var(--color-primary); border: 1px solid var(--color-primary); /* Changed */
    padding: calc(var(--spacing-unit) * 0.75) calc(var(--spacing-unit) * 1.75); /* 6px 14px */
    font-size: 0.85em; font-weight: 500; border-radius: 20px; /* More pill-like */
    cursor: pointer; transition: all 0.2s;
}
button.prompt-button:hover {
    background-color: var(--color-primary); color: var(--color-text-inverted);
    transform: translateY(-1px);
}

button#saveJournalEntryButton {
    display: block; width: 100%;
    margin-top: calc(var(--spacing-unit) * 2.5); /* 20px */
    padding: calc(var(--spacing-unit) * 1.5); /* 12px */
    font-size: 1em; font-weight: 500;
    background-color: var(--color-primary); color: var(--color-text-inverted);
    letter-spacing: 0.5px;
}
button#saveJournalEntryButton:hover:not(:disabled) {
    background-color: var(--color-primary-dark);
}

/* CONFIRMATION MESSAGES */
.confirmation-message {
    display: none; text-align: center;
    padding: calc(var(--spacing-unit) * 1.5); /* 12px */
    border: 1px solid transparent; border-radius: var(--border-radius-medium);
    margin-top: calc(var(--spacing-unit) * 2.5); /* 20px */
    animation: fadeInConfirm 0.4s; font-weight: 500; font-size: 0.95em;
}
.confirmation-message.success { background-color: var(--color-success-bg); color: var(--color-success); border-color: #A3D9B1; }
.confirmation-message.error   { background-color: var(--color-error-bg); color: var(--color-error); border-color: #F1B9BF; }
.confirmation-message.warning { background-color: var(--color-warning-bg); color: #B08800; border-color: #FFE58C; }
@keyframes fadeInConfirm { 0% {opacity: 0; transform: translateY(10px);} 100% {opacity: 1; transform: translateY(0);} }

/* CARDS CONTAINER */
#cardsContainerArea h3 {
    color: var(--color-text-dark); text-align: center;
    margin-bottom: calc(var(--spacing-unit) * 3); /* 24px */
    font-weight: 600; font-size: 1.6em;
    margin-top: calc(var(--spacing-unit) * 6); /* 48px */
}
.card-view-unified {
    display: flex; flex-direction: column; gap: calc(var(--spacing-unit) * 3); /* 24px */
    max-width: 760px; margin: calc(var(--spacing-unit) * 3) auto; /* 24px auto */
}
.response-card {
    background: var(--color-bg-content);
    border-radius: var(--border-radius-large); /* More rounded cards */
    box-shadow: var(--shadow-medium);
    overflow: hidden; border: 1px solid #E9ECEF; /* Softer border */
    transition: box-shadow 0.3s ease;
}
.response-card:hover {
    box-shadow: var(--shadow-strong);
}

.response-card .card-header {
    font-weight: 600; font-size: 1.05em; cursor: pointer;
    background: #FCFDFE; /* Very light, almost white */
    padding: calc(var(--spacing-unit) * 1.75) calc(var(--spacing-unit) * 2.5); /* 14px 20px */
    color: var(--color-text-dark); border-bottom: 1px solid #F0F3F5;
    display: flex; justify-content: space-between; align-items: center;
    transition: background-color 0.2s ease;
}
.response-card .card-header:hover {
    background: #F5F8FB;
}
.response-card .card-header span:first-child { flex-grow: 1; margin-right: var(--spacing-unit); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
.response-card .card-header .card-date { font-size: 0.8em; color: var(--color-text-light); white-space: nowrap; font-weight: 400;}
.response-card .card-header::after {
    content: '›'; font-size: 1.5em; transition: transform 0.3s ease;
    color: var(--color-primary); margin-left: var(--spacing-unit); line-height: 1;
    font-weight: bold;
}
.response-card.open .card-header::after {transform: rotate(90deg);}

.response-card .card-content { max-height: 0; padding: 0 calc(var(--spacing-unit) * 2.5); overflow-y: hidden; transition: max-height 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), padding-top 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), padding-bottom 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }
.response-card.open .card-content { max-height: 10000px; padding: calc(var(--spacing-unit) * 2.5) calc(var(--spacing-unit) * 2.5); /* 20px */}

.introspectie-entry-details {
    margin-bottom: calc(var(--spacing-unit) * 2.5); /* 20px */
    border: 1px solid #F0F3F5; border-radius: var(--border-radius-medium);
    background: #FBFCFD;
}
.introspectie-entry-details summary {
    cursor: pointer; padding: var(--spacing-unit) calc(var(--spacing-unit) * 1.5); /* 8px 12px */
    font-weight: 500; color: var(--color-primary-dark);
    background-color: #F5F8FB; border-radius: var(--border-radius-medium) var(--border-radius-medium) 0 0;
    list-style-position: inside;
    transition: background-color 0.2s ease;
}
.introspectie-entry-details summary:hover { background-color: #EDF2F9; }
.introspectie-entry-details[open] summary { border-bottom: 1px solid #F0F3F5; }
.introspectie-entry-content-text {
    padding: calc(var(--spacing-unit) * 1.5); /* 12px */
    font-size: 0.95em; line-height: 1.7; color: var(--color-text-medium);
    max-height: 500px; overflow-y: auto; white-space: pre-wrap;
}
.introspectie-entry-content-text hr {margin: calc(var(--spacing-unit) * 2) 0; border: 0; border-top: 1px dashed #DDE2E7;}
.introspectie-entry-content-text h4 { font-size: 1em; color: var(--color-primary); margin-top: calc(var(--spacing-unit) * 2); margin-bottom:var(--spacing-unit); font-weight: 600;}
.introspectie-entry-content-text p { margin-bottom: calc(var(--spacing-unit) * 1.25); }
.introspectie-entry-content-text p strong { font-weight: 600; color: var(--color-text-dark); margin-right: calc(var(--spacing-unit)*0.5); }
.introspectie-entry-content-text::-webkit-scrollbar { width: 6px; }
.introspectie-entry-content-text::-webkit-scrollbar-thumb { background: #D1D9E2; border-radius:3px; }

.journal-entry-content-text-unified { white-space: pre-wrap; font-size: 1em; line-height: 1.75; color: var(--color-text-medium); }

.response-card > .card-content > h4.ai-feedback-title {
    color: var(--color-secondary-dark); font-weight: 600; margin-top: 0;
    margin-bottom: calc(var(--spacing-unit) * 2); /* 16px */
    font-size: 1.2em;
    border-bottom: 1px solid #E7F0F9; padding-bottom: var(--spacing-unit);
}
.no-feedback-message { text-align: center; font-style: italic; color: var(--color-text-light); padding: calc(var(--spacing-unit) * 2) 0; }
.ai-feedback-history-container { margin-top: calc(var(--spacing-unit) * 1.5); /* 12px */ }
.feedback-entry-card {
    background: #FDFEFF; padding: calc(var(--spacing-unit) * 2); /* 16px */
    border: 1px solid #E7F0F9;
    border-left: 4px solid var(--color-secondary); border-radius: var(--border-radius-medium); margin-bottom:calc(var(--spacing-unit) * 2);
    font-size:0.95em; line-height:1.65; box-shadow: var(--shadow-light);
}
.feedback-timestamp { color: var(--color-text-light); font-size:0.8em; margin-bottom:var(--spacing-unit); font-style: italic; }
.feedback-section-item { margin-bottom: var(--spacing-unit); }
.feedback-section-item h5 {
    font-size: 1em; color: var(--color-secondary-dark); margin-top:0;
    margin-bottom: calc(var(--spacing-unit)*0.5); font-weight:600;
}
.feedback-section-item p, .feedback-section-item ul { margin-left: var(--spacing-unit); font-size: 0.95em; }
.feedback-section-item ul { padding-left: calc(var(--spacing-unit)*2); }
.feedback-section-item li { margin-bottom: calc(var(--spacing-unit)*0.5); }


.card-actions {
    margin-top: calc(var(--spacing-unit) * 2.5); /* 20px */
    padding-top: calc(var(--spacing-unit) * 2); /* 16px */
    border-top: 1px solid #F0F3F5;
    display: flex; flex-wrap: wrap; gap: var(--spacing-unit); /* 8px */
    justify-content: flex-end;
}
.card-actions button {
    padding: calc(var(--spacing-unit) * 0.75) calc(var(--spacing-unit) * 1.5); /* 6px 12px */
    font-size: 0.8em; font-weight:500; border-radius: var(--border-radius-medium); /* Increased */
    transition: all 0.2s; border: 1px solid transparent; cursor: pointer;
    background-color: #F8F9FA; /* Light gray background for all */
    color: var(--color-text-medium);
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.card-actions button:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}
button.delete-introspectie-button { color: var(--color-error); border-color: var(--color-error-bg); }
button.delete-introspectie-button:hover { background-color: var(--color-error); color: white; }
button.regenerate-feedback-button { color: var(--color-success); border-color: var(--color-success-bg); }
button.regenerate-feedback-button:hover { background-color: var(--color-success); color: white;}
button.discuss-entry-with-chat-button { color: var(--color-primary); border-color: var(--color-primary-light); }
button.discuss-entry-with-chat-button:hover { background-color: var(--color-primary); color: white;}
button.delete-last-feedback-button { color: var(--color-accent); border-color: var(--color-warning-bg); }
button.delete-last-feedback-button:hover { background-color: var(--color-accent); color: #493709;} /* Darker text for contrast on orange */
button.delete-all-feedback-button { color: #AB240C; border-color: #FEE9E5;}
button.delete-all-feedback-button:hover { background-color: #AB240C; color: white;}


/* AI GENERATED CONTENT (inside cards) */
.content-ai { font-size: 1em; line-height: 1.75; color: var(--color-text-medium); }
.content-ai h1, .content-ai h2, .content-ai h3, .content-ai h4, .content-ai .ai-main-section-title {
    font-weight: 600; color: var(--color-secondary-dark); /* Minty for AI content headers */
    margin-top: 1.4em; margin-bottom: 0.7em;
    font-size: 1.1em; padding-bottom: calc(var(--spacing-unit)*0.5);
}
.content-ai h1:first-child, /* etc. */ .content-ai .ai-main-section-title:first-child { margin-top: 0.5em; }
.content-ai p, .content-ai p.ai-text-paragraph { margin-bottom: 1em; }
.content-ai strong, .content-ai p.ai-text-paragraph strong { font-weight: 600; color: var(--color-text-dark); }
.content-ai em, .content-ai p.ai-text-paragraph em { font-style: italic; color: var(--color-text-medium); }
.content-ai ul, .content-ai ol, .content-ai ul.ai-list, .content-ai ol.ai-list {
    margin-left: calc(var(--spacing-unit)*0.5); padding-left: calc(var(--spacing-unit)*2.5);
    margin-bottom: 1em; list-style-position: outside;
}
.content-ai li, .content-ai .ai-list-item { margin-bottom: 0.6em; }
.content-ai li::marker, .content-ai .ai-list-item::marker { color: var(--color-secondary); font-weight: bold; }

.content-ai .ai-text-error {
    color: var(--color-error); font-weight: 500; background-color: var(--color-error-bg);
    padding: var(--spacing-unit) calc(var(--spacing-unit)*1.5); border-radius: var(--border-radius-small);
    border: 1px solid #F1B9BF; border-left: 4px solid var(--color-error);
    white-space: pre-wrap; font-size: 0.9em;
}
.raw-feedback-display { white-space: pre-wrap; font-family: monospace; font-size: 0.9em; padding: 10px; background: #f0f0f0; border-radius: 4px; max-height: 300px; overflow-y: auto;}

.no-entries-message, .loading-message, .error-loading-message { text-align: center; margin-top:calc(var(--spacing-unit)*3); font-style: italic; color: var(--color-text-light); font-size: 1.05em; padding:var(--spacing-unit)*2;}
.error-loading-message { color: var(--color-error); font-weight: 500;}
.loading-message { color: var(--color-primary); font-weight: 500; }

/* CHAT INTERFACE */
.chat-container {
    display: none; flex-direction: column; position: fixed; bottom: 20px; right: 20px;
    width: clamp(360px, 30vw, 420px);
    max-height: calc(100vh - 100px); /* Va fi ajustat in media query */
    background: var(--color-bg-content);
    border-radius: var(--border-radius-large);
    box-shadow: var(--shadow-strong);
    z-index: 1000; padding: 0; box-sizing: border-box; overflow: hidden;
    border: 1px solid #DEE2E6;
}
.chat-container h3 { /* Titlu Chat */
    text-align: center; color: var(--color-text-dark); margin: 0;
    padding: calc(var(--spacing-unit) * 1.5) calc(var(--spacing-unit) * 2); /* 12px 16px | Redus usor */
    font-size: 1.05em; font-weight: 600; /* Redus usor */
    background-color: #F8F9FA;
    border-bottom: 1px solid #E9ECEF; flex-shrink: 0;
    display: flex; justify-content: space-between; align-items: center; /* For minimize button */
}
#chatMessages {
    flex-grow: 1;
    overflow-y: auto;
    overflow-anchor: none;      /* Dezactivează scroll anchoring */
    padding: calc(var(--spacing-unit) * 1.5);
    background: var(--color-bg-content);
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit) * 1.25);
}
#chatMessages::-webkit-scrollbar { width: 7px; }
#chatMessages::-webkit-scrollbar-track { background: transparent; }
#chatMessages::-webkit-scrollbar-thumb { background: #CED4DA; border-radius: 10px; }
#chatMessages::-webkit-scrollbar-thumb:hover { background: #ADB5BD; }

.chat-message {
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*2);
    border-radius: var(--border-radius-large);
    max-width: 80%;
    word-wrap: break-word; line-height: 1.5;
    box-shadow: var(--shadow-light);
    font-size: 0.95em; font-weight: 400; position: relative;
    display: flex; /* Adăugat pentru a alinia <details> și conținutul principal */
    flex-direction: column; /* Gândurile deasupra, conținutul principal dedesubt */
}
.user-message {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
    color: var(--color-text-inverted);
    align-self: flex-end; margin-left: auto;
    border-bottom-right-radius: var(--border-radius-small);
}
.ai-message {
    background: var(--color-bg-chat-alt);
    color: var(--color-text-dark);
    align-self: flex-start; margin-right: auto;
    border-bottom-left-radius: var(--border-radius-small);
    font-family: var(--font-primary);
}
.ai-message em, .ai-message i { font-family: var(--font-primary), inherit; font-style: italic; }
.ai-message strong, .ai-message b { font-family: var(--font-primary), inherit; font-weight: 600; }
.ai-message.ai-error {
    background-color: var(--color-error-bg); color: var(--color-error);
    border: 1px solid #F5C6CB;
    font-family: var(--font-primary), sans-serif;
}
.ai-message pre.code-block-chat { background:#eef; padding:5px; border-radius:4px; white-space:pre-wrap; word-break:break-all; font-size: 0.9em; }
.ai-message code.inline-code-chat { background:#eef; padding:1px 3px; border-radius:3px; font-size: 0.9em; }
.ai-message h6 { margin-top: 0.8em; margin-bottom: 0.4em; font-size: 1.05em; font-weight: 600; color: var(--color-text-dark);}
.ai-message ul, .ai-message ol { margin-top: 0.5em; margin-bottom: 0.5em; padding-left: 20px;}
.ai-message li { margin-bottom: 0.25em;}

.ai-message .main-answer-text { /* Stil pentru textul principal, după thoughts */
    margin-top: 5px; /* Adaugă un mic spațiu dacă există thoughts deasupra */
}
.ai-message .main-answer-text:first-child { /* Dacă nu există thoughts, nu e nevoie de spațiu sus */
    margin-top: 0;
}


/* NOU: Zona de input și buton reproiectată */
.chat-input-area {
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*1.5); /* 10px 12px */
    border-top: 1px solid #E9ECEF; background-color: #F8F9FA;
    flex-shrink: 0;
    display: flex; /* NOU: Facem flexibil pentru aliniere input și buton */
    align-items: flex-end; /* NOU: Aliniază elementele la bază, util dacă textarea crește */
    gap: calc(var(--spacing-unit)*1); /* 8px NOU: Spațiu între input și buton */
}

#chatInput {
    flex-grow: 1; /* NOU: Input-ul ocupă spațiul disponibil */
    border-radius: 20px; /* Mai rotunjit */
    padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*1.75); /* 10px 14px */
    min-height: 40px; /* Ajustat pentru a se potrivi mai bine cu butonul */
    max-height: 100px;
    font-size: 0.95em;
    line-height: 1.4; /* Îmbunătățește lizibilitatea textului pe mai multe rânduri */
    resize: none; /* Oprește redimensionarea manuală care poate strica layout-ul */
    margin-bottom: 0; /* Elimină marginea de jos dacă exista din stilurile generale */
    border: 1px solid #CED4DA; /* Asigură un chenar vizibil */
}

#sendChatMessageButton {
    flex-shrink: 0; /* NOU: Butonul nu se micșorează */
    width: 40px;    /* NOU: Lățime fixă */
    height: 40px;   /* NOU: Înălțime fixă (potrivită cu min-height al inputului) */
    padding: 0;     /* NOU: Eliminăm padding-ul intern dacă setăm dimensiuni fixe */
    font-family: var(--font-primary);
    font-size: 1.2em; /* Mărime potrivită pentru un icon/simbol */
    font-weight: 500; /* Păstrăm consistența */
    background-color: transparent;
    color: var(--color-primary); /* Culoare pentru icon/text */
    border: none; /* NOU: Fără chenar */
    border-radius: 50%; /* NOU: Buton rotund */
    transition: background-color 0.2s, color 0.2s; /* Tranzitie pentru hover */
    cursor: pointer;
    margin-top:0;
    display: flex; /* NOU: Pentru centrarea iconului */
    align-items: center; /* NOU: Pentru centrarea iconului */
    justify-content: center; /* NOU: Pentru centrarea iconului */
    line-height: 1; /* Asigură centrarea corectă a textului/iconului */
}
#sendChatMessageButton::before { /* Folosim un pseudo-element pentru icon */
    content: "➢"; /* Sau alt icon. Ex: "➤", "▶", "✓" */
}

#sendChatMessageButton:hover:not(:disabled) {
    background-color: var(--color-primary-light); /* Fundal subtil la hover */
    color: var(--color-primary-dark);
    transform: none; /* Eliminăm transformarea de pe butonul general */
    box-shadow: none;
}
#sendChatMessageButton:disabled {
    background-color: transparent !important;
    color: #CED4DA !important; /* Culoare gri pentru starea disabled */
    transform: translateY(0) !important;
    cursor: not-allowed !important;
}
#chatStatus {
    font-size: 0.9em; color: var(--color-text-light); text-align: center;
    min-height: 1.2em;
    font-weight: 300;
    background-color: #F8F9FA; /* Același fundal ca input area */
    margin:0; /* Elimină orice margine default */

}
#toggleChatButton {
    position: fixed; bottom: calc(var(--spacing-unit)*2); right: calc(var(--spacing-unit)*2); /* 16px | Redus pozitionarea */
    padding: 0; z-index: 1001;
    display: flex; align-items: center; justify-content: center;
    background: linear-gradient(145deg, var(--color-secondary) 0%, var(--color-primary) 100%);
    color: var(--color-text-inverted); border: none; border-radius: 50%;
    width: 44px; height: 44px; /* Redus | Original 56x56, apoi 20x20 care era prea mic */
    font-size: 20px; /* Redus | Original 28px */
    line-height: 44px; /* Aliniat cu înălțimea */
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.25); /* Redus umbra */
    cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}
#toggleChatButton:hover {
    transform: scale(1.05) rotate(10deg); /* Redus transformarea */
    box-shadow: 0 6px 18px rgba(74, 144, 226, 0.3);
}

/* Styles for AI Thoughts */
.ai-thoughts-details {
    margin-bottom: 8px; /* Spațiu între gânduri și răspunsul principal */
    background-color: #f0f0f085; /* Fundal ușor diferit, cu transparență */
    border: 1px solid #ddd;
    border-radius: var(--border-radius-small);
    font-size: 0.85em; /* Puțin mai mic */
    opacity: 0.9;
    width: 100%; /* Ocupă lățimea containerului .ai-message */
}
.ai-thoughts-details summary {
    padding: 5px 8px;
    cursor: pointer;
    font-weight: 500;
    color: var(--color-text-medium);
    background-color: #e9ecefbd;
    border-radius: var(--border-radius-small) var(--border-radius-small) 0 0;
    list-style-position: inside; /* Sau none dacă preferi să stilizezi altfel săgeata */
    outline: none; /* Elimină outline-ul la focus pe summary */
}
.ai-thoughts-details summary:hover {
    background-color: #dfe3e6;
}
.ai-thoughts-details[open] summary {
    border-bottom: 1px solid #d5d9dc;
}
.ai-thoughts-content {
    padding: 8px 10px;
    white-space: pre-wrap; /* Esențial pentru \n */
    word-break: break-word; /* Pentru cuvinte lungi */
    font-family: 'Menlo', 'Monaco', 'Consolas', monospace;
    font-size: 0.95em; /* Relativ la .ai-thoughts-details */
    color: #2c3e50; /* O culoare mai închisă pentru lizibilitate */
    max-height: 180px;
    overflow-y: auto;
    background-color: #fdfdfee3;
    border-radius: 0 0 var(--border-radius-small) var(--border-radius-small);
}
.ai-thoughts-content::-webkit-scrollbar { width: 5px; }
.ai-thoughts-content::-webkit-scrollbar-thumb { background: #bababa; border-radius:3px; }
.ai-thoughts-content::-webkit-scrollbar-thumb:hover { background: #a1a1a1; }


.ai-error-inline { /* For errors appearing within a streamed message */
    color: var(--color-error);
    font-style: italic;
    font-size: 0.9em;
    display: block; /* Make it a block to take full width */
    margin-top: 5px;
    padding: 5px;
    background-color: var(--color-error-bg);
    border-left: 3px solid var(--color-error);
}


/* RESPONSIVENESS */
@media (max-width: 820px) {
     .form-section-container, .card-view-unified {
        padding:calc(var(--spacing-unit)*3);
        margin-left:calc(var(--spacing-unit)*2); margin-right:calc(var(--spacing-unit)*2);
        max-width:calc(100% - (var(--spacing-unit)*4));
     }
}
@media (max-width: 768px) {
    body {padding:calc(var(--spacing-unit)*2); font-size: 15px;}
    .form-section-container, .card-view-unified {
        padding:calc(var(--spacing-unit)*2.5);
        margin-left:var(--spacing-unit); margin-right:var(--spacing-unit);
        max-width:calc(100% - (var(--spacing-unit)*2));
    }
    .app-header h1 { font-size: 2em; }
    .tab-button { padding: calc(var(--spacing-unit)*1.25) calc(var(--spacing-unit)*2.5); font-size: 1em;}
    .form-section-container h2 {font-size:1.6em;}
    #cardsContainerArea h3 {font-size: 1.5em;}
    .step-navigation button, button#fisaAddButton, button#saveJournalEntryButton {font-size:0.9em; padding:var(--spacing-unit) calc(var(--spacing-unit)*2);}
    .card-actions button {font-size:0.75em; padding:calc(var(--spacing-unit)*0.75) var(--spacing-unit);}

    .chat-container {
        width: calc(100% - var(--spacing-unit)*2); /* Lățime aproape completă, cu margini mici */
        max-height: calc(100vh - 60px); /* Mai mult spațiu vertical, mai aproape de marginea de sus */
        bottom: var(--spacing-unit); /* Mai aproape de marginea de jos */
        left: var(--spacing-unit); /* Mai aproape de marginea din stânga */
        right: var(--spacing-unit); /* Adaugat pentru a centra pe ecrane mici, dacă left/width nu sunt suficiente */
        border-radius: var(--border-radius-medium); /* Raze mai mici pe mobil */
    }
    #toggleChatButton {
        width: 40px; height: 40px; font-size: 18px; line-height: 40px;
        bottom: calc(var(--spacing-unit)*1.5); right: calc(var(--spacing-unit)*1.5); /* 12px */
    }
    #chatInput {
        padding: calc(var(--spacing-unit)*1) calc(var(--spacing-unit)*1.5); /* 8px 12px */
        min-height: 38px;
        font-size: 0.9em;
    }
    #sendChatMessageButton {
        width: 38px; height: 38px;
        font-size: 1.1em;
    }
    .chat-input-area {
        padding: var(--spacing-unit); /* 8px */
    }
}
@media (max-width: 480px) {
    body {padding:var(--spacing-unit); font-size: 14px;}
    .form-section-container, .card-view-unified {
        padding:calc(var(--spacing-unit)*1.5);
        margin-left:calc(var(--spacing-unit)*0.5); margin-right:calc(var(--spacing-unit)*0.5);
        max-width:calc(100% - var(--spacing-unit));
        border-radius: var(--border-radius-medium);
    }
    .app-header h1 {font-size:1.7em;}
    .tab-button { padding: var(--spacing-unit) calc(var(--spacing-unit)*1.5); font-size: 0.9em;}
    .form-section-container h2 {font-size:1.4em;} #cardsContainerArea h3 {font-size: 1.3em;}
    textarea#journalContent { min-height: 160px; }
    .step-navigation button, button#fisaAddButton, button#saveJournalEntryButton {font-size:0.85em; padding:var(--spacing-unit) calc(var(--spacing-unit)*1.5);}
    .card-actions button {
        font-size:0.7em; padding:calc(var(--spacing-unit)*0.75) var(--spacing-unit);
        flex-basis: calc(50% - (var(--spacing-unit)*0.5) );
    }
    .response-card .card-header {
        padding:var(--spacing-unit) calc(var(--spacing-unit)*1.5);
        flex-direction: column; align-items: flex-start; gap: calc(var(--spacing-unit)*0.5);
    }
    .response-card .card-header::after { align-self: flex-end; margin-top: -1.5em; font-size: 1.3em;}

    .chat-container {
        width: calc(100% - var(--spacing-unit)*2);
        max-height: calc(100vh - var(--spacing-unit)*2 - 50px); /* 50px for browser UI */
        bottom: var(--spacing-unit);
        left: var(--spacing-unit);
        right: var(--spacing-unit);
        border-radius: var(--border-radius-medium);
    }
    .chat-container h3 { padding: var(--spacing-unit) calc(var(--spacing-unit)*1.5); font-size: 1em;}
    #chatMessages { padding: var(--spacing-unit); gap: var(--spacing-unit);}
    .chat-message { padding: var(--spacing-unit) calc(var(--spacing-unit)*1.5); font-size: 0.9em;}

    #chatInput {
        min-height: 36px;
        font-size: 0.9em;
    }
    #sendChatMessageButton {
        width: 36px; height: 36px;
    }
    #toggleChatButton {
        width: 38px; height: 38px; font-size: 16px; line-height: 38px;
        bottom: var(--spacing-unit); right: var(--spacing-unit);
    }
}
#minimizeChatButton {
    background: none;
    border: none;
    color: var(--color-text-medium);
    cursor: pointer;
    padding: 0 var(--spacing-unit);
    line-height: 1;
    font-size: 1.2em; /* Adjust size of chevron */
    font-weight: bold;
}
#minimizeChatButton::after { /* CSS Chevron */
    content: '';
    display: inline-block;
    width: 6px;
    height: 6px;
    border-left: 2px solid currentColor;
    border-bottom: 2px solid currentColor;
    transform: rotate(-45deg);
    margin-left: 5px; /* Optional: space from title text */
}

#minimizeChatButton:hover {
    color: var(--color-primary);
}

.chat-container h3 .chat-title-text {
    flex-grow: 1; /* Allow title to take available space */
    text-align: center; /* Center title if desired, or remove for left align */
    margin-right: auto; /* Push minimize button to the right */
    margin-left: auto; /* If centered */
}
#minimizeChatButton {
    margin-left: var(--spacing-unit); /* Space it from the edge or title */
}

.theme-selection-container, .material-type-selection-container {
    margin-top: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background-color: #f9f9f9;
    border: 1px solid #eee;
    border-radius: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}
.theme-select-button, .material-type-button {
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.2s ease;
    border: 1px solid var(--color-primary);
    background-color: white;
    color: var(--color-primary);
}
.theme-select-button:hover, .material-type-button:hover {
    background-color: var(--color-primary-light);
    transform: translateY(-1px);
}
.material-type-button.button-primary { 
    background-color: var(--color-primary);
    color: white;
}
.material-type-button.button-primary:hover {
    background-color: var(--color-primary-dark);
}
.button-cancel, .theme-select-button.button-cancel, .material-type-button.button-cancel {
    border-color: var(--color-text-light);
    color: var(--color-text-light);
}
.button-cancel:hover {
    background-color: #f0f0f0;
    border-color: #ccc;
}
.material-content-display pre { white-space: pre-wrap; background-color: #f4f4f4; padding: 10px; border-radius: 4px; font-family: monospace; }

 /* --- MODERN FRESH STYLES END --- */