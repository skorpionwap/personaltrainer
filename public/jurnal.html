<!DOCTYPE html>
<html>
<head>
    <title>Jurnal Terapeutic Personal - Psiho</title>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script type="module">
    // --- Configurări Firebase și Gemini ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, getDoc, updateDoc, arrayUnion, query, where, orderBy, limit, Timestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"; // Adăugat Timestamp
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

    const firebaseConfig = {
        apiKey: "AIzaSyBn2bojEoV4_icF4fVVKFdJN1YjDhtlG98", // Înlocuiește cu cheia ta reală
        authDomain: "personaltrainer-74ea4.firebaseapp.com",
        projectId: "personaltrainer-74ea4",
        storageBucket: "personaltrainer-74ea4.appspot.com",
        messagingSenderId: "591778567441",
        appId: "1:591778567441:web:bbaeac19a3fb0f190668b0",
        measurementId: "G-WLWNGNDK5V",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // !!! ÎNLOCUIEȘTE CU CHEIA TA API GEMINI VALIDĂ ȘI ACTIVĂ !!!
    const GEMINI_API_KEY = "AIzaSyAlm63krfJxBu1QR5ZmvA0rcGUnjm17sng"; // <--- CHEIA TA API GEMINI
    const GEMINI_MODEL_NAME_JOURNAL_FEEDBACK = "gemini-2.5-flash-preview-04-17"; // Sau modelul preferat pentru text generativ, ex "gemini-1.5-flash-latest"
    let genAI, geminiModelJournalFeedback;

    if (GEMINI_API_KEY && GEMINI_API_KEY.trim() !== "" && !GEMINI_API_KEY.startsWith("AIzaSyA")) { // Mică verificare să nu fie placeholder
        try {
            genAI = new GoogleGenerativeAI(GEMINI_API_KEY);
            geminiModelJournalFeedback = genAI.getGenerativeModel({ model: GEMINI_MODEL_NAME_JOURNAL_FEEDBACK });
            console.log("SDK Gemini inițializat. Model Feedback Jurnal:", GEMINI_MODEL_NAME_JOURNAL_FEEDBACK);
        } catch (e) {
            console.error("Eroare critică la inițializarea SDK Gemini:", e);
            alert("Eroare la inițializarea serviciului AI. Verificați cheia API Gemini. Funcționalitatea AI va fi limitată.");
            geminiModelJournalFeedback = null;
        }
    } else  {
        console.warn(`Cheia API Gemini pare a fi un placeholder sau lipsește. Funcționalitatea AI va fi dezactivată.`);
        alert("Cheia API Gemini nu este configurată corect. Funcționalitatea AI va fi dezactivată.");
        geminiModelJournalFeedback = null;
    }
    // --- Sfârșit Configurare Gemini ---

    let dataAlreadyLoaded = false;

    window.onload = function () {
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("Jurnal Terapeutic: Utilizator autentificat:", user.uid);
                if (!dataAlreadyLoaded) {
                    incarcaIntrariJurnal(user.uid);
                    dataAlreadyLoaded = true;
                }
            } else {
                console.log("Jurnal Terapeutic: Utilizator neautentificat, redirecționare...");
                window.location.href = "login.html"; // Redirecționează la login
            }
        });

        document.getElementById("saveJournalEntryButton")?.addEventListener("click", salveazaIntrareJurnalSiGenereazaFeedback);
    };

    async function callGeminiAPI(promptText, modelToUse, generationConfigOptions = {}) {
        if (!modelToUse) {
            console.error("Modelul Gemini pentru feedback jurnal este invalid sau neinițializat.");
            return "EROARE: Model AI neinițializat. Verifică cheia API Gemini.";
        }
        try {
            const requestPayload = {
                contents: [{ role: "user", parts: [{ text: promptText }] }],
                generationConfig: { temperature: 0.7, ...generationConfigOptions } 
            };
            const result = await modelToUse.generateContent(requestPayload);
            const response = result.response;

            if (response?.candidates?.[0]?.content?.parts?.[0]?.text) {
                if (response.candidates[0].finishReason && !["STOP", "MAX_TOKENS"].includes(response.candidates[0].finishReason)) {
                     console.warn("Gemini a oprit generarea prematur (jurnal):", response.candidates[0].finishReason, response.candidates[0].safetyRatings);
                    return `EROARE Gemini: Generare oprită (Motiv: ${response.candidates[0].finishReason}).`;
                }
                return response.candidates[0].content.parts[0].text;
            } else if (response?.promptFeedback?.blockReason) {
                 console.error("Prompt blocat de Gemini (jurnal):", response.promptFeedback.blockReasonDetail || response.promptFeedback.blockReason);
                 return `EROARE Gemini: Prompt blocat (Motiv: ${response.promptFeedback.blockReason}). Revizuiește conținutul trimis.`;
            } else {
                console.error("Răspuns Gemini neașteptat sau gol (jurnal):", JSON.stringify(response, null, 2));
                return "EROARE Gemini: Răspuns invalid sau gol de la API.";
            }
        } catch (error) {
            console.error("Eroare detaliată la callGeminiAPI (jurnal):", error, error.stack);
            let errorMessage = `EROARE Gemini: ${error.message || "Eroare API necunoscută"}`;
            // Aici poți adăuga logica detaliată de gestionare a erorilor ca în fișierul original, dacă e nevoie
            if (error.toString().toLowerCase().includes("api key not valid")) {
                 errorMessage = "EROARE: Cheia API Gemini nu este validă sau nu are permisiuni.";
            } else if (error.message && (error.message.toLowerCase().includes("quota"))) {
                errorMessage = "EROARE: Limita de utilizare a API-ului Gemini a fost depășită.";
            }
            return errorMessage;
         }
    }
    
    async function genereazaFeedbackJurnalCuGemini(promptText) { 
        if (!geminiModelJournalFeedback) {
            console.error("Modelul Gemini pentru feedback jurnal nu este inițializat. Feedback-ul AI nu va fi generat.");
            return "EROARE: Funcționalitatea AI pentru jurnal nu este disponibilă. Verifică configurația cheii API Gemini.";
        }
        console.log("Trimitere prompt către Gemini (feedback jurnal, primele 100 caractere):", promptText.substring(0, 100) + "...");
        return await callGeminiAPI(promptText, geminiModelJournalFeedback, { temperature: 0.72 }); // Temperatură specifică
    }

    async function proceseazaSiStructureazaFeedbackJurnal(feedbackText, docId) {
        console.log("Răspuns brut de la Gemini (feedback jurnal):\n---\n" + feedbackText + "\n---");
        const parsedFeedback = {
            rawText: feedbackText,
            model: `Gemini (${GEMINI_MODEL_NAME_JOURNAL_FEEDBACK})`,
            timestamp: new Date().toISOString(), // JS Date, va fi convertit la Timestamp de Firestore la salvarea directă
            error: typeof feedbackText === 'string' && feedbackText.toUpperCase().startsWith("EROARE:")
        };

        if (docId) {
            const docRef = doc(db, "intrariJurnal", docId);
            try {
                const updatePayload = {
                    feedbackAI_history: arrayUnion(parsedFeedback),
                    feedbackAI_latest: parsedFeedback 
                };
                await updateDoc(docRef, updatePayload);
                console.log(`Feedback AI (jurnal, ${parsedFeedback.model}) salvat pentru intrarea ${docId}`);
            } catch (updateError) {
                console.error(`Eroare update Firestore feedback jurnal pentru ${docId}:`, updateError);
            }
        }
        return parsedFeedback;
    }

    async function salveazaIntrareJurnalSiGenereazaFeedback() {
        const journalTextarea = document.getElementById("journalContent");
        const journalTitleInput = document.getElementById("journalTitle");
        
        if (!journalTextarea || journalTextarea.value.trim() === "") {
            alert("Te rog scrie ceva în jurnal înainte de a salva.");
            journalTextarea.focus();
            return;
        }

        const entryData = {
            continut: journalTextarea.value,
            titlu: (journalTitleInput && journalTitleInput.value.trim() !== "") ? journalTitleInput.value.trim() : `Intrare din ${new Date().toLocaleDateString("ro-RO", { day: '2-digit', month: '2-digit', year: 'numeric' })}`,
            timestampCreare: Timestamp.fromDate(new Date()), // Folosește Timestamp din Firebase
            dataIntrare: new Date().toLocaleDateString("ro-RO", { day: '2-digit', month: '2-digit', year: 'numeric' })
        };

        const user = auth.currentUser;
        if (!user) {
            alert("Trebuie să fii autentificat pentru a salva în jurnal.");
            window.location.href = "login.html";
            return;
        }
        entryData.ownerUid = user.uid;
        
        const saveButton = document.getElementById("saveJournalEntryButton");
        const originalButtonText = saveButton.textContent;
        saveButton.textContent = "Se salvează și se generează...";
        saveButton.disabled = true;
        const confirmationMsg = document.getElementById('journalConfirmationMessage');

        try {
            const docRef = await addDoc(collection(db, "intrariJurnal"), entryData);
            console.log(`Intrare jurnal salvată cu ID: ${docRef.id}. Se generează feedback AI...`);
            
            const promptJurnal = `
Rolul meu personalizat pentru PsihoGPT Jurnal (pentru uz personal, sunt în terapie):
"Ești PsihoGPT, asistentul meu personal AI pentru scriere terapeutică și auto-reflecție. Te consider un 'partener de dialog' informat de diverse școli psihoterapeutice (TCC, Scheme, ACT, IFS, Psihodinamică, Centrată pe Emoții). Scopul tău este să mă ajuți să adâncesc înțelegerea propriei mele experiențe, să identific tipare, să explorez perspective și să facilitez procesul de integrare emoțională. Abordarea ta este una de curiositate empatică, provocare blândă și rezonanță cu conceptele terapeutice. Am suport terapeutic uman, deci poți fi mai direct în reflecții și poți folosi termeni tehnici relevanți, atâta timp cât menții un ton suportiv și cald."

Intrarea mea de jurnal este:
Titlu: ${entryData.titlu}
Conținut:
---
${entryData.continut}
---

Te rog să-mi oferi un feedback structurat după cum urmează, adaptat pentru mine:
1.  **Sumar Empatic Concis:** (1-2 propoziții, validând esența emoțională sau tema principală.)
2.  **Observații Cheie și Tipare Identificate:** (2-4 puncte relevante, potențiale tipare de gândire, emoționale, sau comportamentale observate. Poți fi direct.)
3.  **Conexiuni Conceptuale (Opțional, unde e cazul):** (Menționează 1-2 concepte/modele psihoterapeutice care par a ilumina ce am scris. Ex: cum se manifestă o schemă, un mecanism de coping, o distorsiune cognitivă, o nevoie neîndeplinită, principii ACT etc.)
4.  **Întrebări Specifice pentru Aprofundare:** (2-3 întrebări deschise, tăioase dar constructive, care să mă invite la o reflecție mai profundă asupra celor scrise, bazate pe conținutul meu și pe conceptele identificate.)
5.  **Sugestie de Focalizare (pentru auto-lucru):** (O scurtă sugestie despre un aspect pe care l-aș putea explora mai departe în următoarea intrare, sau un micro-exercițiu de reflecție bazat pe discuția noastră. Ex: "Pentru următoarea intrare, ai putea explora [tema] din perspectiva [model terapeutic]".)

Folosește un limbaj clar, profesionist, dar empatic. Nu ezita să folosești termeni tehnici pe care i-am putea discuta în terapie. Mulțumesc!`;

            const feedbackText = await genereazaFeedbackJurnalCuGemini(promptJurnal);
            await proceseazaSiStructureazaFeedbackJurnal(feedbackText, docRef.id);
            
            const docSnapshot = await getDoc(docRef); 
            if (docSnapshot.exists()) {
                afiseazaCardJurnal({ id: docSnapshot.id, ...docSnapshot.data() });
            }
            
            journalTextarea.value = ""; 
            if (journalTitleInput) journalTitleInput.value = "";

            if (feedbackText.toUpperCase().startsWith("EROARE:")) {
                 confirmationMsg.textContent = `Intrarea a fost salvată. Feedback AI: ${feedbackText}`;
                 confirmationMsg.className = 'confirmation-message error';
            } else {
                 confirmationMsg.textContent = 'Intrarea a fost salvată și feedback-ul AI generat! Îl poți vedea în cardul de mai jos.';
                 confirmationMsg.className = 'confirmation-message success';
            }
            confirmationMsg.style.display = 'block';
            setTimeout(() => { confirmationMsg.style.display = 'none'; }, 9000);

        } catch (error) {
            console.error("Eroare la salvarea în jurnal sau generarea feedback-ului:", error);
            confirmationMsg.textContent = 'Eroare la salvarea intrării sau la generarea feedback-ului AI.';
            confirmationMsg.className = 'confirmation-message error';
            confirmationMsg.style.display = 'block';
             setTimeout(() => { confirmationMsg.style.display = 'none'; }, 7000);
        } finally {
            saveButton.textContent = originalButtonText;
            saveButton.disabled = false;
        }
    }
    
    function afiseazaIstoricFeedbackJurnal(containerElement, feedbackHistory) {
        containerElement.innerHTML = ''; 
        if (!feedbackHistory || !Array.isArray(feedbackHistory) || feedbackHistory.length === 0) {
            const noHistoryMsg = document.createElement("p");
            noHistoryMsg.textContent = "Niciun feedback AI generat pentru această intrare.";
            noHistoryMsg.style.fontStyle = "italic";
            noHistoryMsg.style.textAlign = "center";
            containerElement.appendChild(noHistoryMsg);
            return;
        }

        feedbackHistory.slice().reverse().forEach((entry, index) => { 
            const itemContainer = document.createElement("div");
            itemContainer.className = "feedback-entry-card"; // Reutilizează stilul dacă e potrivit

            const timestampAndModel = document.createElement("p");
            timestampAndModel.className = "feedback-timestamp";
            timestampAndModel.innerHTML = `<strong>Feedback #${feedbackHistory.length - index}</strong> (${new Date(entry.timestamp).toLocaleString("ro-RO")} - ${entry.model || 'N/A'})`;
            itemContainer.appendChild(timestampAndModel);

            if (entry.error) {
                const errorP = document.createElement("p");
                errorP.style.color = "red";
                errorP.style.fontWeight = "bold";
                errorP.innerHTML = (entry.rawText || "Eroare la generarea acestui feedback.").replace(/\n/g, '<br>');
                itemContainer.appendChild(errorP);
            } else {
                const contentP = document.createElement("p");
                contentP.style.whiteSpace = "pre-wrap";
                contentP.innerHTML = (entry.rawText || 'Conținut indisponibil.').replace(/\n/g, '<br>');
                itemContainer.appendChild(contentP);
            }
            containerElement.appendChild(itemContainer);
        });
    }

    function afiseazaCardJurnal(entryData) {
        const container = document.getElementById("journalEntriesContainer");
        // Verifică dacă există deja un card pentru această intrare pentru a evita duplicarea
        let card = container.querySelector(`.journal-card[data-id="${entryData.id}"]`);
        const cardExists = !!card;

        if (!card) {
            card = document.createElement("div");
            card.className = "response-card journal-card"; 
            card.setAttribute("data-id", entryData.id);
            
            const entryDate = entryData.dataIntrare || (entryData.timestampCreare?.toDate ? new Date(entryData.timestampCreare.toDate()).toLocaleDateString("ro-RO") : 'Dată necunoscută');
            const entryTitle = entryData.titlu || `Intrare din ${entryDate}`;

            card.innerHTML = `
                <div class="card-header"> 
                    ${entryTitle} 
                </div>
                <div class="card-content">
                    <p><strong>Data intrării:</strong> ${entryDate}</p>
                    <p><strong>Conținut Jurnal:</strong></p>
                    <p class="journal-entry-content">${entryData.continut.replace(/\n/g, '<br>')}</p>
                    
                    <h4>Feedback AI PsihoGPT</h4>
                    <div class="ai-feedback-history-container">
                        <!-- Feedback AI istoric -->
                    </div>
                    <div class="card-actions">
                         <button class="delete-journal-entry-button" title="Șterge Intrarea și Feedback-ul">Șterge Intrarea</button>
                    </div>
                </div>
            `;
            card.querySelector('.card-header').addEventListener('click', () => {
                card.classList.toggle('open');
            });
            card.querySelector('.delete-journal-entry-button').addEventListener('click', (e) => {
                e.stopPropagation();
                stergeIntrareJurnal(entryData.id, card);
            });

            if (container.firstChild) {
                container.insertBefore(card, container.firstChild);
            } else {
                container.appendChild(card);
            }
        }
        
        const feedbackContainer = card.querySelector('.ai-feedback-history-container');
        if (feedbackContainer) {
            afiseazaIstoricFeedbackJurnal(feedbackContainer, entryData.feedbackAI_history || []);
        }

        // Pentru a preveni creșterea textului la fiecare update dacă cardul există deja
        // Actualizăm doar conținutul, nu innerHTML întreg
        if(cardExists){
            const contentP = card.querySelector('.journal-entry-content');
            if(contentP) contentP.innerHTML = entryData.continut.replace(/\n/g, '<br>');
        }

    }

    async function stergeIntrareJurnal(id, cardElement) {
        if (confirm("Ești sigur că vrei să ștergi această intrare din jurnal și tot feedback-ul AI asociat?")) {
            try {
                await deleteDoc(doc(db, "intrariJurnal", id));
                cardElement.remove();
                // Afișează un mesaj de confirmare dacă nu mai sunt intrări
                const container = document.getElementById("journalEntriesContainer");
                if(container && container.childElementCount === 0) {
                    container.innerHTML = `<p style="text-align:center; margin-top:20px; font-style:italic;">Nicio intrare în jurnal găsită.</p>`;
                }
                // Nu mai e nevoie de alert(), feedback-ul vizual e suficient
            } catch (error) {
                console.error("Eroare la ștergerea intrării din jurnal:", error);
                alert("Eroare la ștergerea intrării.");
            }
        }
    }

    async function incarcaIntrariJurnal(userId) {
        const container = document.getElementById("journalEntriesContainer");
        if (!container || !userId) {
            console.warn("Containerul pentru jurnal sau userId lipsesc la încărcare.");
            return;
        }
        container.innerHTML = '<p style="text-align:center; margin-top:20px;">Se încarcă intrările din jurnal...</p>';

        try {
            const q = query(collection(db, "intrariJurnal"), where("ownerUid", "==", userId), orderBy("timestampCreare", "desc"));
            const querySnapshot = await getDocs(q);
            container.innerHTML = ''; // Curăță mesajul "Se încarcă..."

            if (querySnapshot.empty) {
                container.innerHTML = `<p style="text-align:center; margin-top:20px; font-style:italic;">Nicio intrare în jurnal găsită. Începe prin a scrie una!</p>`;
                return;
            }
            querySnapshot.forEach((doc) => {
                afiseazaCardJurnal({ id: doc.id, ...doc.data() });
            });
        } catch (error) {
            console.error("Eroare la încărcarea intrărilor din jurnal:", error);
            container.innerHTML = '<p style="text-align:center; margin-top:20px; color:red;">A apărut o eroare la încărcarea intrărilor din jurnal.</p>';
        }
    }
    </script>
    <style>
    /* --- AICI VA FI CODUL CSS COMPLET (body, form-container, card-uri etc. FĂRĂ CHAT) --- */
    /* Asigură-te că ai stilurile pentru Ubuntu aplicate pe body și elemente */
    body {
        font-family: 'Ubuntu', 'Roboto', 'Montserrat', 'Nunito Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Oxygen, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        margin: 0; padding: 20px; background: linear-gradient(to right, #f4f6f8, #e9eef2); color: #34495e; box-sizing: border-box;
    }
    .journal-form-container { /* Renumit din .form-container pentru specificitate */
        max-width: 800px; margin: 30px auto; background: #fff; padding: 30px; 
        box-shadow: 0 10px 25px rgba(0,0,0,0.08); border-radius: 12px;
    }
    .journal-form-container h2, h3 { /* h3 este pentru titlul listei de intrări */
        color: #2c3e50; text-align: center; margin-bottom: 25px; font-weight: 500;
    }
    textarea#journalContent, input#journalTitle { /* Aplicăm stiluri mai specifice pentru a nu afecta alte input-uri/textarea dacă ar exista */
        width: 100%; /* Mai simplu cu box-sizing: border-box */
        padding: 12px; 
        margin-bottom: 15px; /* Spațiu între titlu și conținut */
        font-size: 1em; 
        font-family: inherit; 
        border-radius: 8px; 
        border: 1px solid #dce4ec; 
        resize: vertical; 
        box-shadow: 0 1px 3px rgba(0,0,0,0.04) inset; 
        transition: border-color 0.3s, box-shadow 0.3s;
        box-sizing: border-box; /* Important */
    }
    textarea#journalContent {
        min-height: 200px;
        line-height: 1.6;
    }
    input#journalTitle {
        font-weight: 500; /* Titlu puțin mai proeminent */
    }
    textarea#journalContent:focus, input#journalTitle:focus {
        border-color: #6c92f2; box-shadow: 0 0 0 3.5px rgba(108, 146, 242, 0.18); outline: none;
    }
    button#saveJournalEntryButton { /* Butonul specific pentru jurnal */
        display: block; /* Pentru a ocupa toată lățimea și a centra textul dacă e nevoie */
        width: 100%;
        margin-top: 10px; /* Spațiu redus după textarea */
        padding: 14px 25px; /* Buton mai proeminent */
        font-family: inherit; font-size: 1.05em; font-weight: 500; 
        background: #6c92f2;
        color: white; border: none; border-radius: 8px; cursor: pointer; 
        transition: background-color 0.3s, transform 0.2s;
        box-shadow: 0 3px 8px rgba(108, 146, 242, 0.25);
    }
    button#saveJournalEntryButton:hover:not(:disabled) { background-color: #5478d6; transform: translateY(-2px); }
    button#saveJournalEntryButton:disabled { background: #b0c4de !important; color: #7e8c9e !important; cursor: not-allowed !important; transform: translateY(0) !important; box-shadow: none !important;}

    .confirmation-message {
        display: none; text-align: center; padding: 15px; 
        border: 1px solid transparent; border-radius: 8px; 
        margin-top: 20px; animation: fadeIn 0.5s; font-weight: 500;
    }
    .confirmation-message.success { background-color: #e6f9f0; color: #1f794d; border-color: #b3e6d1; }
    .confirmation-message.error { background-color: #fdeded; color: #c0392b; border-color: #f8c9c9; }
    @keyframes fadeIn { 0% {opacity: 0; transform: translateY(10px);} 100% {opacity: 1; transform: translateY(0);} }
    
    .card-view {display: flex; flex-direction: column; gap: 25px; max-width: 800px; margin: 30px auto;}
    .response-card { /* Comun pentru toate cardurile (dacă mai apar și altele) */
        background: #ffffff; padding: 0; border-radius: 12px; 
        box-shadow: 0 8px 20px rgba(0,0,0,0.07);
        overflow: hidden;
    }
    .response-card .card-header {
        font-weight: 500; font-size: 1.1em; cursor: pointer; 
        background: #f8faff;
        padding: 15px 25px; color: #34495e; text-align: left; position: relative; 
        display: flex; justify-content: space-between; align-items: center;
        border-bottom: 1px solid #e9eef2;
    }
    .response-card .card-header::after {content: '▼'; font-size: 0.8em; transition: transform 0.3s ease; color: #7f8c8d;}
    .response-card.open .card-header::after {transform: rotate(180deg);}
    .response-card .card-content {
        max-height: 0; margin-top: 0; padding: 0 25px; 
        line-height: 1.65; overflow-y: auto; /* overflow-x ascuns by default */
        transition: max-height 0.6s cubic-bezier(0.25, 0.1, 0.25, 1), 
                    padding-top 0.6s cubic-bezier(0.25, 0.1, 0.25, 1), 
                    padding-bottom 0.6s cubic-bezier(0.25, 0.1, 0.25, 1);
    } 
    .response-card.open .card-content {
        max-height: 6000px; /* Valoare mare pentru a permite conținut lung */
        padding-top: 20px; padding-bottom: 20px;
    }
    .response-card .card-content p {margin-bottom: 12px;}
    .response-card .card-content p.journal-entry-content { /* Clasa specifică pentru conținutul jurnalului */
        white-space: pre-wrap; /* Păstrează formatarea textului */
        font-size: 1.02em; /* Puțin mai mare pentru lizibilitate */
        color: #34495e;
    }
    .response-card .card-content p strong {font-weight: 700; color: #2c3e50;}
    .response-card h4 {
        text-align: left; color: #6c92f2; font-weight: 500; margin-top: 25px; 
        margin-bottom: 15px; font-size: 1.05em;
        border-bottom: 1px dashed #dce4ec; padding-bottom: 8px;
    }
    .response-card h4:first-child {margin-top: 0;} /* Dacă e primul element */
     .ai-feedback-history-container {
        margin-top: 10px;
    }
    .feedback-entry-card {
        background:#f0f4f8; 
        padding:15px; 
        border-left:4px solid #6c92f2; 
        border-radius:8px; 
        margin-bottom:15px; 
        font-size:0.95em; 
        line-height:1.6;
    }
    .feedback-timestamp {
        color:#555; font-size:0.85em; margin-bottom:10px; font-style: italic;
    }
    .card-actions {text-align: right; margin-top: 25px; padding-bottom: 0px; border-top: 1px solid #e9eef2; padding-top: 15px;}
    .card-actions button {
        padding: 8px 18px; font-size: 0.9em; margin-left: 10px;
        background-color: transparent; box-shadow: none;
        border-radius: 6px; /* Rotunjire pentru butoane în card */
    }
    button.delete-journal-entry-button { color: #e74c3c; border: 1px solid #f1c0ba;}
    button.delete-journal-entry-button:hover { background-color: #e74c3c; color: white; border-color: #e74c3c;}
    
    /* Stiluri Responsive */
    @media (max-width: 768px) {
        body {padding:15px;}
        .journal-form-container, .card-view {padding:20px; margin-left:0; margin-right:0; max-width:100%;}
        textarea#journalContent, input#journalTitle {font-size: 0.95em;}
        button#saveJournalEntryButton {font-size: 1em;}
        .response-card .card-header {font-size: 1.05em; padding: 12px 20px;}
        .response-card .card-content {padding-left: 20px; padding-right: 20px;}
    }
    @media (max-width: 480px) {
        body {padding:10px;}
        .journal-form-container, .card-view {padding:15px;}
        textarea#journalContent { min-height: 150px; }
        .response-card .card-header {font-size: 1em; padding: 10px 15px;}
        .response-card.open .card-content {padding-top: 15px; padding-bottom: 15px;}
        .card-actions {text-align: center;}
        .card-actions button {margin-left: 5px; margin-right: 5px; display: block; width: calc(100% - 10px); margin-bottom:10px;}
        .card-actions button:last-child {margin-bottom:0;}

    }
    </style>
</head>
<body>

    <div class="journal-form-container">
        <h2>Jurnal Terapeutic Personal</h2>
        <p style="text-align: center; margin-top: -15px; margin-bottom: 25px; font-size: 0.9em; color: #555;">
            Acesta este spațiul tău de reflecție. Explorează-ți gândurile și emoțiile.
        </p>
    
        <form id="therapeuticJournalForm" onsubmit="return false;"> <!-- Previne submit-ul default al formei -->
            <label for="journalTitle" style="display:block; margin-bottom: 5px; font-weight: 500; color: #34495e;">Titlu (Opțional):</label>
            <input type="text" id="journalTitle" name="journalTitle" placeholder="Ex: Reflecții despre ziua de azi, O conversație dificilă...">
            
            <label for="journalContent" style="display:block; margin-bottom: 5px; margin-top: 15px; font-weight: 500; color: #34495e;">Intrarea ta în jurnal:</label>
            <textarea id="journalContent" name="journalContent" rows="12" placeholder="Scrie liber aici despre ce simți, ce gândești, ce ai experimentat..."></textarea>
            
            <button type="button" id="saveJournalEntryButton">Salvează Intrarea și Cere Feedback AI</button>
        </form>

        <div id="journalConfirmationMessage" class="confirmation-message">
            <!-- Mesajul de confirmare/eroare va fi setat de JavaScript -->
        </div>
    </div>
    
    <h3 style="text-align: center; margin-top: 40px; margin-bottom: 20px; color: #2c3e50; font-weight: 500;">Istoricul Intrărilor din Jurnal:</h3>
    
    <div class="card-view" id="journalEntriesContainer">
        <!-- Cardurile cu intrările din jurnal și feedback AI vor fi adăugate aici de JavaScript -->
        <!-- Exemplu de mesaj dacă nu sunt intrări, gestionat de JS -->
        <!-- <p style="text-align:center; margin-top:20px; font-style:italic;">Nicio intrare în jurnal găsită. Începe prin a scrie una!</p> -->
    </div>
    
</body>
</html>