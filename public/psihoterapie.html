<!DOCTYPE html>
<html>
<head>
    <title>FiÈ™Äƒ Monitorizare - Psiho</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, getDoc, updateDoc, arrayUnion, query, where } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

    // Configurarea Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBn2bojEoV4_icF4fVVKFdJN1YjDhtlG98", // AsigurÄƒ-te cÄƒ aceasta este cheia ta corectÄƒ
        authDomain: "personaltrainer-74ea4.firebaseapp.com",
        projectId: "personaltrainer-74ea4",
        storageBucket: "personaltrainer-74ea4.appspot.com",
        messagingSenderId: "591778567441",
        appId: "1:591778567441:web:bbaeac19a3fb0f190668b0",
        measurementId: "G-WLWNGNDK5V",
    };

    // IniÈ›ializare Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentStep = 1;
    let totalSteps = 0;

    window.onload = function () {
        totalSteps = document.querySelectorAll('.form-step').length;
        updateProgressBar();
        const urlParams = new URLSearchParams(window.location.search);
        const collabId = urlParams.get('collabId');
        
        if (!collabId) {
            populateTableData(); // Aceasta va apela È™i loadTableData pentru carduri
        }

        const nextButton = document.getElementById("nextButton");
        if (nextButton) nextButton.addEventListener("click", nextStep);

        const prevButton = document.getElementById("prevButton");
        if (prevButton) prevButton.addEventListener("click", previousStep);

        const addButton = document.getElementById("addButton");
        if (addButton) addButton.addEventListener("click", adaugaInTabel);

        const generateLinkButton = document.getElementById("generateLinkButton");
        if (generateLinkButton) generateLinkButton.addEventListener("click", generateCollaborationLink);

        if (!collabId) {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log("Utilizator autentificat:", user.uid);
                } else {
                    console.log("Utilizator neautentificat, redirecÈ›ionare...");
                    window.location.href = "login.html";
                }
            });
        }
    };

    function nextStep() {
        if (currentStep < totalSteps) {
            document.getElementById(`step-${currentStep}`).classList.remove('form-step-active');
            currentStep++;
            document.getElementById(`step-${currentStep}`).classList.add('form-step-active');
            updateProgressBar();
        }
    }

    function previousStep() {
        if (currentStep > 1) {
            document.getElementById(`step-${currentStep}`).classList.remove('form-step-active');
            currentStep--;
            document.getElementById(`step-${currentStep}`).classList.add('form-step-active');
            updateProgressBar();
        }
    }

    function updateProgressBar() {
        const progress = document.getElementById('progress');
        if(progress) {
            const progressPercentage = (currentStep / totalSteps) * 100;
            progress.style.width = progressPercentage + '%';
        }
    }

    async function genereazaFeedbackAI(rowData, docId) { // docId este necesar pentru updateDoc
      const prompt = `
AnalizeazÄƒ aceastÄƒ fiÈ™Äƒ de auto-reflecÈ›ie È™i oferÄƒ feedback psihologic structurat:
1. âœï¸ Un paragraf empatic.
2. â“ O Ã®ntrebare de reflecÈ›ie.
3. ğŸ› ï¸ O recomandare terapeuticÄƒ (CBT, DBT sau mindfulness).
4. ğŸ” IdentificÄƒ posibile distorsiuni cognitive (ex: suprageneralizare, personalizare).
5. ğŸ§  IdentificÄƒ posibile scheme si moduri cognitive implicate, conform schema therapy (ex: eÈ™ec, neajutorare, neacceptare, defectivitate, abandon, deprivare).
6. ğŸ§â€â™‚ï¸ EvalueazÄƒ dacÄƒ Adultul SÄƒnÄƒtos este prezent È™i cum ar putea fi activat mai mult.

Date:
SituaÈ›ie: ${rowData.situatie  || 'N/A'}
GÃ¢nduri: ${rowData.ganduri || 'N/A'}
EmoÈ›ii: ${rowData.emotii || 'N/A'}
Comportament: ${rowData.comportament || 'N/A'}
Adult sÄƒnÄƒtos: ${rowData.adult_sanatos || 'N/A'}

Format rÄƒspuns:
Paragraf: ...
Ãntrebare: ...
Recomandare: ...
Distorsiuni: ...
Scheme: ...
Adult SÄƒnÄƒtos: ...`;

      const models = [
        { name: "google/gemma-3-27b-it:free", label: "Gemma 27B" }
      ];
      const openRouterApiKey = "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"; // ATENÈšIE LA SECURITATE!

      for (const model of models) {
        try {
          const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
            method: "POST",
            headers: {
              "Authorization": `Bearer ${openRouterApiKey}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              model: model.name,
              messages: [{ role: "user", content: prompt }],
              temperature: 0.7
            })
          });

          const data = await response.json();
          if (data.error) {
            console.warn(`Eroare de la API-ul OpenRouter (${model.label}):`, data.error.message);
            continue; // ÃncearcÄƒ urmÄƒtorul model
          }
          if (data.choices && data.choices.length > 0 && data.choices[0].message) {
            const content = data.choices[0].message.content.trim();
            const feedback = {
              paragraf: content.match(/Paragraf:\s*(.+?)(?:\nÃntrebare:|\nRecomandare:|\nDistorsiuni:|\nScheme:|\nAdult SÄƒnÄƒtos:|$)/is)?.[1]?.trim() || "Nu s-a putut extrage paragraful.",
              intrebare: content.match(/Ãntrebare:\s*(.+?)(?:\nRecomandare:|\nDistorsiuni:|\nScheme:|\nAdult SÄƒnÄƒtos:|$)/is)?.[1]?.trim() || "Nu s-a putut extrage Ã®ntrebarea.",
              recomandare: content.match(/Recomandare:\s*(.+?)(?:\nDistorsiuni:|\nScheme:|\nAdult SÄƒnÄƒtos:|$)/is)?.[1]?.trim() || "Nu s-a putut extrage recomandarea.",
              distorsiuni: content.match(/Distorsiuni:\s*(.+?)(?:\nScheme:|\nAdult SÄƒnÄƒtos:|$)/is)?.[1]?.trim() || "Nu s-au putut extrage distorsiunile.",
              scheme: content.match(/Scheme:\s*(.+?)(?:\nAdult SÄƒnÄƒtos:|$)/is)?.[1]?.trim() || "Nu s-au putut extrage schemele.",
              adult_sanatos_eval: content.match(/Adult SÄƒnÄƒtos:\s*(.+)$/is)?.[1]?.trim() || "Nu s-a putut extrage evaluarea Adultului SÄƒnÄƒtos.",
              model: model.label,
              timestamp: new Date().toISOString()
            };

            if (docId) { // docId trebuie sÄƒ fie valid
              const docRef = doc(db, "raspunsuri", docId);
              await updateDoc(docRef, {
                feedback_history: arrayUnion(feedback),
                feedback_paragraf: feedback.paragraf, // ActualizeazÄƒ È™i cÃ¢mpurile individuale pentru ultimul feedback
                feedback_intrebare: feedback.intrebare,
                feedback_recomandare: feedback.recomandare,
                feedback_distorsiuni: feedback.distorsiuni,
                feedback_scheme: feedback.scheme,
                feedback_adult_eval: feedback.adult_sanatos_eval,
                feedback_model: feedback.model
              });
              console.log(`Feedback AI de la ${model.label} salvat pentru docId: ${docId}`);
            }
            return feedback;
          } else {
             console.warn(`RÄƒspuns neaÈ™teptat de la modelul ${model.label}:`, data);
          }
        } catch (error) {
          console.warn(`Modelul ${model.label} a eÈ™uat sau a returnat un format neaÈ™teptat:`, error);
        }
      }
      console.log("Toate modelele AI au eÈ™uat sau nu au returnat feedback valid.");
      return { // Feedback de fallback
        paragraf: "Feedback indisponibil momentan. VÄƒ rugÄƒm Ã®ncercaÈ›i din nou mai tÃ¢rziu.",
        intrebare: "", recomandare: "", distorsiuni: "", scheme: "", adult_sanatos_eval: "",
        model: "N/A", timestamp: new Date().toISOString()
      };
    }

    async function adaugaInTabel() {
        const form = document.getElementById("exercitiuForm");
        const formData = new FormData(form);
        const rowData = { date: new Date().toLocaleDateString() };
        formData.forEach((value, key) => { rowData[key] = value; });

        try {
            const docRef = await addDoc(collection(db, "raspunsuri"), rowData);
            rowData.id = docRef.id;
            console.log(`RÄƒspuns salvat cu ID: ${docRef.id}. Se genereazÄƒ feedback AI automat...`);

            const feedbackGenerat = await genereazaFeedbackAI(rowData, docRef.id); // Generare automatÄƒ
            if (feedbackGenerat) {
                if (!rowData.feedback_history) rowData.feedback_history = [];
                rowData.feedback_history.push(feedbackGenerat);
            }

            adaugaCard(rowData); // AdaugÄƒ cardul cu datele È™i primul feedback
            
            form.reset();
            currentStep = 1;
            const activeStep = document.querySelector('.form-step-active');
            if (activeStep) activeStep.classList.remove('form-step-active');
            document.getElementById('step-1').classList.add('form-step-active');
            updateProgressBar();

            const confirmationMessage = document.getElementById('confirmationMessage');
            confirmationMessage.textContent = 'Formularul a fost trimis È™i feedback-ul AI generat! Ãl puteÈ›i vedea Ã®n cardul de mai jos.';
            confirmationMessage.style.display = 'block';
            setTimeout(() => { confirmationMessage.style.display = 'none'; }, 7000);

        } catch (error) {
            console.error("Eroare la salvarea Ã®n Firestore sau generarea feedback-ului AI:", error);
            alert("A apÄƒrut o eroare. VÄƒ rugÄƒm Ã®ncercaÈ›i din nou.");
        }
    }

    // NOUA FUNCÈšIE pentru a afiÈ™a/actualiza istoricul de feedback
    function afiseazaIstoricFeedback(containerElement, feedbackHistory) {
        containerElement.innerHTML = ''; // CurÄƒÈ›Äƒm containerul Ã®nainte de a repopula

        if (feedbackHistory && Array.isArray(feedbackHistory) && feedbackHistory.length > 0) {
            const historyTitle = document.createElement("h4");
            historyTitle.style.color = "#4A90E2";
            historyTitle.style.marginTop = "20px"; // SpaÈ›iu deasupra titlului istoricului
            historyTitle.style.marginBottom = "10px";
            historyTitle.textContent = "ğŸ—‚ï¸ Istoric Feedback AI:";
            containerElement.appendChild(historyTitle);

            feedbackHistory.slice().reverse().forEach(entry => { // Cel mai nou primul
                const item = document.createElement("div");
                item.style.marginBottom = "10px";
                item.innerHTML = `
                    <p style="background: #eef6ff; padding: 10px; border-left: 4px solid #4A90E2; border-radius: 5px; margin-bottom: 5px; font-size: 0.9em;">
                      <strong>${new Date(entry.timestamp).toLocaleString()}</strong> (Model: ${entry.model || 'N/A'})<br>
                      âœï¸ ${entry.paragraf || '<i>Indisponibil</i>'}<br>
                      â“ ${entry.intrebare || '<i>Indisponibil</i>'}<br>
                      ğŸ› ï¸ ${entry.recomandare || '<i>Indisponibil</i>'}<br>
                      ğŸ” <strong>Distorsiuni:</strong> ${entry.distorsiuni || '<i>Indisponibil</i>'}<br>
                      ğŸ§  <strong>Scheme:</strong> ${entry.scheme || '<i>Indisponibil</i>'}<br>
                      ğŸ§â€â™‚ï¸ <strong>Adult SÄƒnÄƒtos:</strong> ${entry.adult_sanatos_eval || '<i>Indisponibil</i>'}
                    </p>
                `;
                containerElement.appendChild(item);
            });
        } else {
            const noFeedbackMessage = document.createElement("p");
            noFeedbackMessage.textContent = "Niciun feedback AI generat Ã®ncÄƒ pentru aceastÄƒ intrare.";
            noFeedbackMessage.style.fontStyle = "italic";
            noFeedbackMessage.style.marginTop = "15px";
            containerElement.appendChild(noFeedbackMessage);
        }
    }

   function adaugaCard(rowData) {
      const existingCard = document.querySelector(`.response-card[data-id="${rowData.id}"]`);
      if (existingCard) { // DacÄƒ existÄƒ, actualizÄƒm doar istoricul AI (util dacÄƒ se genereazÄƒ manual pe un card existent)
            const historyContainer = existingCard.querySelector('.ai-feedback-history-container');
            if (historyContainer) {
                afiseazaIstoricFeedback(historyContainer, rowData.feedback_history);
            }
            return; // Nu recreÄƒm tot cardul
      }

      const cardViewContainer = document.getElementById("cardViewContainer");
      const card = document.createElement("div");
      card.className = "response-card";
      card.setAttribute("data-id", rowData.id);
      // Am simplificat un pic HTML-ul pentru a fi mai uÈ™or de gestionat, punÃ¢nd butoanele È™i istoricul la finalul .card-content
      card.innerHTML = `
        <div class="card-header"> Data: ${rowData.date || ''} - SituaÈ›ia: ${rowData.situatie || ''}</div>
        <div class="card-content">
          <h4>Explorarea situaÈ›iei È™i a nevoilor</h4>
          <p><strong>Care este situaÈ›ia?</strong> ${rowData.situatie || ''}</p>
          <p><strong>Ce Ã®mi trece prin minte?</strong> ${rowData.ganduri || ''}</p>
          <p><strong>Cum mÄƒ face acel gÃ¢nd sÄƒ mÄƒ simt?</strong> ${rowData.emotii || ''}</p>
          <p><strong>Ce mod este activ?</strong> ${rowData.mod_activ || ''}</p>
          <p><strong>Ce comportament simÈ›i cÄƒ adopÈ›i?</strong> ${rowData.comportament || ''}</p>
          <p><strong>Care sunt nevoile tale mai profunde?</strong> ${rowData.nevoi_profunde || ''}</p>
          <p><strong>MÄƒ ajutÄƒ comportamentul meu sÄƒ Ã®ndeplinesc aceste nevoi?</strong> ${rowData.ajutor_comportament || ''}</p>
          <p><strong>Cum ar gÃ¢ndi È™i cum s-ar comporta Adultul SÄƒnÄƒtos?</strong> ${rowData.adult_sanatos || ''}</p>

          <h4>Analiza gÃ¢ndurilor È™i a percepÈ›iilor</h4>
          <p><strong>Ce mÄƒ face sÄƒ cred cÄƒ gÃ¢ndul automat este adevÄƒrat?</strong> ${rowData.dovezi_adevar || ''}</p>
          <p><strong>Ce mÄƒ face sÄƒ cred cÄƒ nu este adevÄƒrat?</strong> ${rowData.dovezi_fals || ''}</p>
          <p><strong>ExistÄƒ o explicaÈ›ie alternativÄƒ?</strong> ${rowData.explicatie_alternativa || ''}</p>
          <p><strong>Care este cel mai rÄƒu lucru care s-ar putea Ã®ntÃ¢mpla?</strong> ${rowData.scenariu_negativ || ''}</p>
          <p><strong>Care este cel mai bun lucru care s-ar putea Ã®ntÃ¢mpla?</strong> ${rowData.scenariu_optimist || ''}</p>
          <p><strong>Care este cel mai realist rezultat?</strong> ${rowData.rezultat_realist || ''}</p>
          <p><strong>Ce s-ar Ã®ntÃ¢mpla dacÄƒ mi-aÈ™ schimba modul de gÃ¢ndire?</strong> ${rowData.schimbare_gandire || ''}</p>
          <p><strong>Ce i-aÈ™ spune unui prieten dacÄƒ ar fi Ã®n aceeaÈ™i situaÈ›ie?</strong> ${rowData.sfat_prieten || ''}</p>

          <h4>ÃntrebÄƒri pentru claritate È™i reflecÈ›ie suplimentarÄƒ</h4>
          <p><strong>VÄƒd doar partea rea a lucrurilor?</strong> ${rowData.partea_rea || ''}</p>
          <p><strong>Ãmi asum responsabilitatea pentru lucruri care nu au stat Ã®n puterea mea?</strong> ${rowData.responsabilitate || ''}</p>
          <p><strong>MÄƒ condamn Ã®n baza unui singur eveniment?</strong> ${rowData.condamnare || ''}</p>
          <p><strong>Privesc situaÈ›ia Ã®n termeni extremi?</strong> ${rowData.termeni_extremi || ''}</p>
          <p><strong>Exagerez situaÈ›ia?</strong> ${rowData.exagerare || ''}</p>
          <p><strong>ExistÄƒ È™i alÈ›i factori responsabili?</strong> ${rowData.factori_responsabili || ''}</p>
          <p><strong>Am sÄƒrit direct la concluzii?</strong> ${rowData.concluzii || ''}</p>
          <p><strong>Ãmi pun Ã®ntrebÄƒri fÄƒrÄƒ rÄƒspuns?</strong> ${rowData.intrebari_fara_raspuns || ''}</p>
          <p><strong>MÄƒ concentrez doar asupra slÄƒbiciunilor mele?</strong> ${rowData.slabiciuni || ''}</p>
          <p><strong>MÄƒ zbat prea mult gÃ¢ndind la cum ar trebui sÄƒ fie lucrurile?</strong> ${rowData.cum_ar_trebui || ''}</p>
          <p><strong>MÄƒ aÈ™tept sÄƒ fiu perfect?</strong> ${rowData.perfectiune || ''}</p>
          
          <div class="card-actions" style="text-align: center; margin-top: 20px; padding-bottom: 10px; border-top: 1px solid #eee; padding-top: 15px;">
              <button class="generate-ai-feedback-button">SolicitÄƒ Feedback AI</button>
              <button class="delete-button" style="margin-left: 10px; background-color: #f44336;">È˜terge</button>
          </div>
          <div class="ai-feedback-history-container">
              <!-- Istoricul AI va fi adÄƒugat aici de funcÈ›ia afiseazaIstoricFeedback -->
          </div>
        </div>
      `;

      card.querySelector('.card-header').addEventListener('click', () => {
        card.classList.toggle('open');
      });

      card.querySelector('.delete-button').addEventListener('click', (event) => {
        event.stopPropagation();
        stergeCard(rowData.id, card);
      });

      card.querySelector('.generate-ai-feedback-button').addEventListener('click', async (event) => {
        event.stopPropagation();
        const button = event.target;
        const originalButtonText = button.textContent;
        button.textContent = 'Se genereazÄƒ...';
        button.disabled = true;
        
        try {
            console.log(`Solicitare manualÄƒ feedback AI pentru card: ${rowData.id}`);
            // Important: AsigurÄƒ-te cÄƒ `rowData` are toate cÃ¢mpurile necesare pentru prompt.
            // DacÄƒ a fost Ã®ncÄƒrcat iniÈ›ial doar un subset (ex. din loadTableData), ar trebui sÄƒ preiei documentul complet.
            // SÄƒ presupunem cÄƒ `rowData` este complet sau cÄƒ `genereazaFeedbackAI` poate funcÈ›iona cu ce are.
            // Ideal, ar trebui sÄƒ preluÄƒm documentul actualizat din Firestore aici.
            const docSnapshot = await getDoc(doc(db, "raspunsuri", rowData.id));
            let currentCardData = rowData; // Folosim rowData iniÈ›ial ca fallback
            if (docSnapshot.exists()) {
                currentCardData = { id: docSnapshot.id, ...docSnapshot.data() };
            } else {
                console.warn("Documentul nu a fost gÄƒsit Ã®n Firestore pentru regenerare feedback. Folosim datele locale.");
            }


            const feedbackNou = await genereazaFeedbackAI(currentCardData, currentCardData.id);

            // ActualizÄƒm istoricul Ã®n currentCardData (care e o copie a datelor din DB sau rowData)
            if (!currentCardData.feedback_history) currentCardData.feedback_history = [];
            currentCardData.feedback_history.push(feedbackNou);

            // Re-afiÈ™Äƒm secÈ›iunea de istoric feedback Ã®n cardul curent
            // (funcÈ›ia genereazaFeedbackAI deja a salvat Ã®n Firestore, aici actualizÄƒm doar UI-ul)
            afiseazaIstoricFeedback(card.querySelector('.ai-feedback-history-container'), currentCardData.feedback_history);

        } catch (error) {
            console.error("Eroare la generarea manualÄƒ a feedback-ului AI:", error);
            alert("A apÄƒrut o eroare la generarea feedback-ului AI.");
        } finally {
            button.textContent = originalButtonText;
            button.disabled = false;
        }
      });

      // AfiÈ™eazÄƒ istoricul AI iniÈ›ial (dacÄƒ existÄƒ, ex. de la generarea automatÄƒ)
      afiseazaIstoricFeedback(card.querySelector('.ai-feedback-history-container'), rowData.feedback_history);

      if (cardViewContainer.firstChild) {
          cardViewContainer.insertBefore(card, cardViewContainer.firstChild);
      } else {
          cardViewContainer.appendChild(card);
      }
    }


    let dataAlreadyLoaded = false; 

    async function loadTableData(collabId, pin) {
        if (dataAlreadyLoaded && collabId) {
            console.log("Datele colaboratorului au fost deja Ã®ncÄƒrcate.");
            return;
        }
        console.log("ÃncÄƒrcare date din Firestore pentru carduri...");
        try {
            const q = collabId ? query(collection(db, "raspunsuri"), where("ownerUidForCollab", "==", collabData.owner)) : collection(db, "raspunsuri");
            // Linia de mai sus pentru query necesitÄƒ ca la salvarea rÄƒspunsului sÄƒ se salveze È™i un `ownerUidForCollab`
            // Momentan, vom Ã®ncÄƒrca toate rÄƒspunsurile pentru simplitate, dar filtrarea e necesarÄƒ pentru colaborare realÄƒ.
            const querySnapshot = await getDocs(collection(db, "raspunsuri"));

            const cardViewContainer = document.getElementById("cardViewContainer");
            cardViewContainer.innerHTML = ''; 

            const documents = [];
            querySnapshot.forEach((doc) => {
                documents.push({ id: doc.id, ...doc.data() });
            });

            documents.sort((a, b) => { // SorteazÄƒ descrescÄƒtor dupÄƒ datÄƒ
                const dateA = a.date ? new Date(a.date.split('.').reverse().join('-')) : new Date(0);
                const dateB = b.date ? new Date(b.date.split('.').reverse().join('-')) : new Date(0);
                return dateB - dateA;
            });
            
            documents.forEach(docData => {
                adaugaCard(docData); // rowData este acum docData
            });

            if (collabId) dataAlreadyLoaded = true;
        } catch (error) {
            console.error("Eroare la Ã®ncÄƒrcarea cardurilor din Firestore:", error.message);
        }
    }

    async function populateTableData(collabIdForLoad, pinForLoad) {
        const urlParams = new URLSearchParams(window.location.search);
        const collabIdFromUrl = urlParams.get('collabId');
        if (collabIdFromUrl && dataAlreadyLoaded) {
            console.log("Datele pentru colaborator sunt deja afiÈ™ate Ã®n carduri, tabelul nu se populeazÄƒ separat.");
            return;
        }

        const tableBody = document.getElementById("tableBody");
        if (!tableBody) return; 
        tableBody.innerHTML = ""; // GoleÈ™te tabelul Ã®nainte de a repopula

        try {
            const querySnapshot = await getDocs(collection(db, "raspunsuri"));
            const docsData = [];
            querySnapshot.forEach(doc => docsData.push({id: doc.id, ...doc.data()}));

            docsData.sort((a, b) => {
                const datePartsA = a.date ? a.date.split('.') : ["01","01","1970"];
                const dateA = new Date(`${datePartsA[2]}-${datePartsA[1]}-${datePartsA[0]}`);
                const datePartsB = b.date ? b.date.split('.') : ["01","01","1970"];
                const dateB = new Date(`${datePartsB[2]}-${datePartsB[1]}-${datePartsB[0]}`);
                return dateB - dateA;
            });

            docsData.forEach((data) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td data-label="Data">${data.date || ''}</td>
                    <td data-label="SituaÈ›ia">${data.situatie || ''}</td>
                    <td data-label="GÃ¢nduri">${data.ganduri || ''}</td>
                    <td data-label="EmoÈ›ii">${data.emotii || ''}</td>
                    <td data-label="Mod activ">${data.mod_activ || ''}</td>
                    <td data-label="Comportament">${data.comportament || ''}</td>
                    <td data-label="Nevoile">${data.nevoi_profunde || ''}</td>
                    <td data-label="Ajutor comport.">${data.ajutor_comportament || ''}</td>
                    <td data-label="Adult SÄƒnÄƒtos">${data.adult_sanatos || ''}</td>
                    <td><button onclick="window.toggleDetails('${data.id}')">Extinde</button></td>
                `;
                tableBody.appendChild(row);

                const detailRow = document.createElement("tr");
                detailRow.id = `details-${data.id}`;
                detailRow.style.display = "none";
                detailRow.innerHTML = `<td colspan="10"><div class="detail-card styled-detail-card">...</div></td>`; // ConÈ›inutul detaliilor omis pentru scurtare
                tableBody.appendChild(detailRow);
            });
            
            if (!collabIdFromUrl) { 
                 loadTableData(); // ÃncarcÄƒ È™i cardurile pentru utilizatorul normal
            }

        } catch (error) {
            console.error("Eroare la Ã®ncÄƒrcarea Ã®n tabel din Firestore:", error.message);
        }
    }

    window.toggleDetails = function(id) {
        const detailRow = document.getElementById(`details-${id}`);
        if (detailRow) {
            detailRow.style.display = detailRow.style.display === "none" ? "table-row" : "none";
        }
    }

    async function stergeCard(id, cardElement) {
        if (confirm("SunteÈ›i sigur cÄƒ doriÈ›i sÄƒ È™tergeÈ›i aceastÄƒ Ã®nregistrare È™i tot feedback-ul asociat?")) {
            try {
                await deleteDoc(doc(db, "raspunsuri", id));
                cardElement.remove();
                // Ar fi bine sÄƒ reÃ®mprospÄƒtezi È™i tabelul dacÄƒ este vizibil
                const tableBody = document.getElementById("tableBody");
                if (tableBody && tableBody.querySelector(`tr[data-row-id="${id}"]`)) { // PresupunÃ¢nd cÄƒ ai adÄƒuga data-row-id
                    populateTableData(); 
                }
            } catch (error) {
                console.error("Eroare la È™tergerea din Firestore:", error);
                alert("Eroare la È™tergerea Ã®nregistrÄƒrii.");
            }
        }
    }

    async function generateCollaborationLink() {
        const user = auth.currentUser;
        if (!user) {
            alert("Trebuie sÄƒ fiÈ›i autentificat.");
            return;
        }
        const existingCollabQuery = query(collection(db, "collaborations"), where("owner", "==", user.uid));
        const querySnapshot = await getDocs(existingCollabQuery);
        if (!querySnapshot.empty) {
            const collabDoc = querySnapshot.docs[0];
            const collaborationLink = `${window.location.origin}${window.location.pathname}?collabId=${collabDoc.id}`;
            prompt(`Link existent (PIN: ${collabDoc.data().pin}). DistribuiÈ›i link È™i PIN:`, collaborationLink);
            return;
        }
        const pinCode = prompt("IntroduceÈ›i un cod PIN (minim 4 cifre):");
        if (!pinCode || pinCode.length < 4) {
            alert("Cod PIN invalid.");
            return;
        }
        try {
            const docRef = await addDoc(collection(db, "collaborations"), { owner: user.uid, pin: pinCode, createdAt: new Date() });
            const collaborationLink = `${window.location.origin}${window.location.pathname}?collabId=${docRef.id}`;
            prompt(`Link generat (PIN: ${pinCode}). DistribuiÈ›i link È™i PIN:`, collaborationLink);
        } catch (error) {
            console.error("Eroare la generarea link-ului de colaborare:", error);
        }
    }

    window.addEventListener('DOMContentLoaded', async () => {
        console.log("DOMContentLoaded");
        const urlParams = new URLSearchParams(window.location.search);
        const collabId = urlParams.get('collabId');

        if (collabId) {
            console.log("Colaborator: ascundem elemente È™i cerem PIN.");
            ['exercitiuForm', 'generateLinkButton', '.form-container', '.table-container'].forEach(sel => {
                const el = document.querySelector(sel) || document.getElementById(sel);
                if (el) el.style.display = 'none';
            });
            
            const pin = prompt("IntroduceÈ›i PIN pentru colaborare:");
            if (!pin) {
                alert("PIN necesar."); window.location.href = "login.html"; return;
            }
            try {
                const collabDocRef = doc(db, "collaborations", collabId);
                const collabSnapshot = await getDoc(collabDocRef);
                if (collabSnapshot.exists()) {
                    const collabData = collabSnapshot.data();
                    if (collabData.pin === pin) {
                        console.log("PIN corect. ÃncÄƒrcare date colaborator.");
                        if (!dataAlreadyLoaded) {
                           // ATENÈšIE: `loadTableData` ar trebui sÄƒ filtreze datele pe baza `collabData.owner`
                           // Momentan, Ã®ncarcÄƒ tot. NecesitÄƒ ajustare pentru colaborare realÄƒ.
                           loadTableData(collabId, pin); 
                        }
                    } else {
                        alert("PIN incorect."); window.location.href = "login.html";
                    }
                } else {
                    alert("Colaborare inexistentÄƒ."); window.location.href = "login.html";
                }
            } catch (error) {
                console.error("Eroare accesare colaborare:", error);
                alert("Eroare accesare colaborare."); window.location.href = "login.html";
            }
        }
    });
    </script>
    <style>
        /* ... STILURILE RÄ‚MÃ‚N ACELEAÈ˜I CA ÃN VERSIUNEA ANTERIOARÄ‚ ... */
        /* Adaug doar stil pentru noul buton, dacÄƒ e necesar, dar ar trebui sÄƒ preia stilul general al butoanelor */
        .generate-ai-feedback-button {
            background-color: #5bc0de; /* Info blue */
            /* Alte stiluri specifice dacÄƒ doreÈ™ti */
        }
        .generate-ai-feedback-button:hover {
            background-color: #31b0d5;
        }
        .card-actions button {
            padding: 8px 15px;
            font-size: 0.9em;
        }

        /* Restul stilurilor (body, form-container, card-view, response-card etc.) sunt cele din rÄƒspunsul anterior */
        body {
            font-family: 'Roboto', 'Montserrat', sans-serif;
            margin: 0; /* Reset margin */
            padding: 20px; /* Add padding to body */
            background: linear-gradient(to right, #ece9e6, #ffffff);
            color: #333;
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
        }
        .form-container {
            max-width: 900px;
            margin: 20px auto; /* Add margin auto for centering and top/bottom margin */
            background: #fff;
            padding: 30px;
            box-shadow: 0 16px 24px rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border: 3px solid #87CEFA;
            transition: transform 0.3s ease;
        }
        .form-container:hover {
            transform: scale(1.01); /* Subtle hover effect */
        }
        .progress-bar {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 25px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress {
            height: 20px;
            width: 0;
            background-color: #87CEFA;
            transition: width 0.4s ease;
        }
        .question-card {
            margin-bottom: 20px;
            padding: 20px;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        .question-card:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        .question-card h3 {
            font-weight: 700;
            font-size: 1.2em;
            margin-top: 0; /* Reset margin-top for h3 */
            margin-bottom: 10px;
        }
        .question-card p {
            font-weight: 300;
            font-size: 0.95em;
            margin-bottom: 15px;
            color: #555;
            line-height: 1.6;
        }
        textarea {
            width: calc(100% - 22px); /* Adjusted for padding and border */
            padding: 10px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            resize: vertical;
            min-height: 60px; /* Minimum height */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: border-color 0.3s;
        }
        textarea:focus {
            border-color: #87CEFA;
            box-shadow: 0 2px 8px rgba(135, 206, 250, 0.5);
            outline: none; /* Remove default outline */
        }
        input[type="submit"], button { /* Stil general pentru butoane */
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 18px;
            font-weight: 500; /* Medium weight for buttons */
            background: linear-gradient(to right, #87CEFA, #6bb9e7);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s; /* Smoother transform */
        }
        input[type="submit"]:hover, button:hover {
            background: linear-gradient(to right, #6bb9e7, #4A90E2);
            transform: translateY(-2px); /* More subtle lift */
        }
        .form-step {
            display: none;
        }
        .form-step-active {
            display: block;
            animation: fadeIn 0.7s ease-in-out; /* Slightly faster fadeIn */
        }
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); } /* Add slight vertical motion */
            100% { opacity: 1; transform: translateY(0); }
        }
        .step-navigation {
            text-align: center;
            margin-top: 20px;
        }
        .step-navigation button { /* Butoanele de navigare pot avea un stil puÈ›in diferit dacÄƒ e nevoie */
            margin: 0 10px;
        }

        .table-container {
            margin: 30px auto; /* Centered with margin */
            padding: 20px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto; /* Scroll orizontal dacÄƒ tabelul e prea lat */
            max-width: 900px; /* Max width similar to form container */
       }


        .card-view {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-width: 900px; /* Consistent max-width */
            margin: 30px auto; /* Centered with margin */
        }

        .response-card {
            background: #f9f9ff; /* Light lavender background */
            padding: 0; /* Padding-ul va fi pe .card-header È™i .card-content */
            border-radius: 15px; /* Slightly smaller radius */
            box-shadow: 0 8px 16px rgba(0,0,0,0.12); /* Softer shadow */
            transition: box-shadow 0.3s ease; /* Smooth transition for hover */
            position: relative;
            overflow: hidden; /* Ensures content respects border-radius */
        }

        .response-card:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.18); /* Enhanced shadow on hover */
        }

        .response-card .card-header {
            font-weight: 700;
            font-size: 1.1em; /* Slightly larger header font */
            cursor: pointer;
            background: #87CEFA;
            padding: 12px 20px; /* Adjusted padding */
            /* border-radius: 10px 10px 0 0; /* Rounded top corners - eliminat, lÄƒsÄƒm pe response-card */
            color: #fff;
            text-align: left; /* Align text to left for better readability */
            position: relative;
            display: flex; /* For icon alignment */
            justify-content: space-between; /* Space for icon */
            align-items: center; /* Center items vertically */
        }

        .response-card .card-header::after {
            content: 'â–¼'; /* Chevron down */
            font-size: 0.8em; /* Smaller icon */
            transition: transform 0.3s ease;
        }

        .response-card.open .card-header::after {
            transform: rotate(180deg); /* Rotate chevron up */
        }

        .response-card .card-content {
            max-height: 0;
            margin-top: 0; 
            padding: 0 20px; /* Padding left/right when closed */
            background: #fff; 
            /* border: 1px solid #e0e0e0; /* Light border for content area */
            /* border-top: none; /* No top border as header has bottom */
            /* border-radius: 0 0 10px 10px; /* Rounded bottom corners - eliminat */
            line-height: 1.6; 
            overflow: auto; 
            transition: max-height 0.4s ease-out, padding-top 0.4s ease-out, padding-bottom 0.4s ease-out; 
        }

        .response-card.open .card-content {
            max-height: 1200px; /* Generous max-height, ajustat pentru mai mult conÈ›inut */
            padding-top: 15px;
            padding-bottom: 15px; 
        }

        .response-card .card-content p {
            margin-bottom: 12px; 
            border-left: 3px solid #87CEFA;
            padding-left: 10px;
            background: transparent; 
            border-bottom: none; 
            padding-bottom: 0; 
        }
         .response-card .card-content p strong {
            color: #333; 
         }

        .response-card h4 {
            text-align: left; 
            color: #4A90E2;
            font-weight: bold;
            margin-top: 20px; 
            margin-bottom: 10px; 
            font-size: 1.05em; 
        }
         .response-card h4:first-child {
            margin-top: 0; 
         }

        .card-actions { /* Stil pentru containerul de butoane din card */
            text-align: center;
            margin-top: 20px;
            padding-bottom: 10px;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        .card-actions button { /* Stil specific pentru butoanele din card-actions */
            padding: 8px 15px;
            font-size: 0.9em;
            margin-left: 5px;
            margin-right: 5px;
            margin-top: 5px; /* Butoanele din card nu au nevoie de margin-top mare */
        }
        .generate-ai-feedback-button { /* Butonul de generare AI */
            background: #5cb85c; /* Verde */
        }
        .generate-ai-feedback-button:hover {
            background: #4cae4c;
        }
         .delete-button { /* Butonul de È™tergere, dacÄƒ e Ã®n card-actions */
            background-color: #f44336 !important; /* RoÈ™u, !important pentru a suprascrie stilul general dacÄƒ e necesar */
        }
        .delete-button:hover {
            background-color: #d32f2f !important;
        }


        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); /* Lighter shadow */
            border-radius: 10px;
            overflow: hidden; /* For border-radius on table */
        }
        th {
            background: linear-gradient(to right, #6bb9e7, #87CEFA);
            color: white;
            text-align: left; /* Align header text to left */
            padding: 12px 15px; /* Adjusted padding */
            font-size: 0.9em; /* Smaller font for table headers */
            position: sticky;
            top: 0;
            z-index: 2;
        }
        td {
            padding: 10px 15px; /* Adjusted padding */
            text-align: left;
            border-bottom: 1px solid #ddd; /* Only bottom border for rows */
            font-size: 0.85em; /* Smaller font for table data */
        }
        tr:last-child td {
            border-bottom: none; /* No border for the last row */
        }
        tr:hover {
            background-color: #f5f5f5; /* Hover effect for table rows */
        }

        .detail-card { 
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px; 
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.06); 
            margin-top: 10px;
        }
        .styled-detail-card { 
            background: #f0f8ff; 
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin: 10px auto; 
            overflow: hidden;
        }
        .styled-detail-card h4 {
            text-align: center;
            color: #4A90E2;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .styled-detail-card p {
            margin-bottom: 10px;
            border-left: 3px solid #87CEFA;
            padding-left: 8px;
            background: #fff;
            border-bottom: 1px solid #eee; 
            padding-bottom: 8px;
            font-size: 0.95em; 
        }
        
        #confirmationMessage {
            display: none;
            text-align: center;
            padding: 15px;
            background-color: #d4edda; 
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            margin-top: 20px;
            animation: fadeIn 0.5s; 
        }

        .collaboration-section {
            text-align: center;
            margin-top: 30px;
            padding-bottom: 20px; 
        }
        .collaboration-section button { /* Butonul de generare link colaborare */
            background-color: #f0ad4e; /* Portocaliu warning/info */
        }
        .collaboration-section button:hover {
            background-color: #ec971f; 
        }

/* Responsive Adjustments */
@media (max-width: 768px) {
    body {
        padding: 10px;
    }
    .form-container, .table-container, .card-view {
        padding: 15px;
        margin-left: 10px;
        margin-right: 10px;
        max-width: calc(100% - 20px); 
    }
    textarea {
        font-size: 14px;
        padding: 8px;
        width: calc(100% - 18px); 
    }
    /* Butoanele principale din formular È™i navigare */
    .form-container > button, .step-navigation button {
        font-size: 16px;
        padding: 10px 20px;
    }
    /* Butoanele din carduri (acÈ›iuni) */
    .card-actions button {
        font-size: 0.85em; /* Mai mici Ã®n carduri */
        padding: 7px 12px;
    }
    .question-card h3, .response-card .card-header {
        font-size: 1.05em; 
    }
    .question-card p, .response-card .card-content p, .styled-detail-card p {
        font-size: 0.9em;
    }
    .response-card .card-content {
        font-size: 0.9em;
    }
    table, th, td {
        font-size: 0.8em; 
    }
    th, td {
        padding: 8px; 
    }

    .table-container {
        overflow-x: auto; 
    }
    table {
        display: block; 
        width: 100%;
    }
    thead, tbody, tr {
        display: block;
    }
    th { 
         display: none;
    }
    tr {
        margin-bottom: 15px; 
        border: 1px solid #ddd;
        border-radius: 5px;
        display: flex; 
        flex-direction: column;
    }
    td {
        display: flex; 
        justify-content: space-between; 
        padding: 10px;
        text-align: right; 
        border-bottom: 1px solid #eee; 
        position: relative; 
    }
    td:last-child {
        border-bottom: none;
    }
    td::before {
        content: attr(data-label); 
        font-weight: bold;
        text-align: left; 
        margin-right: 10px; 
        color: #555;
        flex-shrink: 0; /* Prevent label from shrinking */
        width: 40%; /* Give label a defined width */
    }
    td > *:not(button) { /* Ensure content in td doesn't overflow excessively */
        flex-grow: 1;
        word-break: break-word;
    }
    td button { 
        width: auto;
        padding: 6px 12px;
        font-size: 0.85em;
        margin-left: auto; 
        flex-shrink: 0; /* Prevent button from shrinking */
    }
     td[colspan="10"] { 
        display: block; 
    }
    td[colspan="10"] .styled-detail-card {
        width: auto; 
    }
}

@media (max-width: 480px) {
    .form-container, .table-container, .card-view {
        padding: 10px;
        margin-left: 5px;
        margin-right: 5px;
        max-width: calc(100% - 10px);
    }
    .question-card h3, .response-card .card-header {
        font-size: 1em;
    }
    .question-card p, .response-card .card-content p, .styled-detail-card p {
        font-size: 0.85em;
    }
    textarea {
        font-size: 13px;
        padding: 6px;
        width: calc(100% - 14px);
    }
    /* Butoanele principale */
    .form-container > button, .step-navigation button {
        font-size: 14px;
        padding: 8px 15px;
    }
    /* Butoanele din carduri */
    .card-actions button {
        font-size: 0.8em; /* È˜i mai mici */
        padding: 6px 10px;
    }
    .response-card .card-header {
        padding: 10px;
    }
    .response-card .card-content {
        padding-left: 15px; /* Ajustare padding pentru ecrane mici */
        padding-right: 15px;
        font-size: 0.85em;
    }
    table, th, td {
        font-size: 0.75em;
    }
    td {
        padding: 8px;
        flex-direction: column; /* Stack label and value on very small screens */
        align-items: flex-start; /* Align items to start */
    }
    td::before {
        margin-right: 0;
        margin-bottom: 5px; /* Space between label and value when stacked */
        width: 100%; /* Label takes full width */
    }
    td button {
        align-self: flex-end; /* Button to the right when td is column */
    }
}

    </style>
</head>
<body>

    <div class="form-container">
        <h2>FiÈ™Äƒ Monitorizare</h2>
        <p>CompleteazÄƒ fiecare Ã®ntrebare pentru a Ã®nÈ›elege mai bine situaÈ›iile tale. Fiecare secÈ›iune reprezintÄƒ o parte importantÄƒ a reflecÈ›iei tale. Ãn acest exerciÈ›iu, Ã®È›i voi ghida fiecare pas, astfel Ã®ncÃ¢t sÄƒ poÈ›i explora Ã®n profunzime gÃ¢ndurile, emoÈ›iile È™i comportamentele tale.</p>
    
        <div class="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
    
        <form id="exercitiuForm">
            <!-- SecÈ›iunile formularului (steps 1-28) rÄƒmÃ¢n neschimbate -->
            <div class="question-card form-step form-step-active" id="step-1">
                <h3>Care este situaÈ›ia?</h3>
                <p>Te rog sÄƒ descrii contextul care a declanÈ™at emoÈ›iile sau comportamentul tÄƒu. ÃncearcÄƒ sÄƒ fii cÃ¢t mai specific È™i detaliat. Aceasta poate fi o situaÈ›ie concretÄƒ din viaÈ›a de zi cu zi Ã®n care te-ai simÈ›it copleÈ™it, stresat sau Ã®ntr-o altÄƒ stare emoÈ›ionalÄƒ intensÄƒ.</p>
                <textarea name="situatie" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-2">
                <h3>Ce Ã®mi trece prin minte?</h3>
                <p>ÃÈ›i cer sÄƒ identifici gÃ¢ndurile automate care au apÄƒrut Ã®n aceastÄƒ situaÈ›ie. Acestea sunt gÃ¢nduri rapide, involuntare, care Ã®È›i trec prin minte Ã®n momentele de stres. Ce Ã®È›i spui Ã®n acel moment? Este un gÃ¢nd critic sau Ã®ngrijorÄƒtor?</p>
                <textarea name="ganduri" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-3">
                <h3>Cum mÄƒ face acel gÃ¢nd sÄƒ mÄƒ simt?</h3>
                <p>Te rog sÄƒ notezi emoÈ›iile pe care le simÈ›i Ã®n urma acelui gÃ¢nd. Ce simÈ›i? FricÄƒ, tristeÈ›e, furie? DÄƒ o intensitate emoÈ›iei (de la 0 la 100) pentru a vedea cÃ¢t de puternicÄƒ este.</p>
                <textarea name="emotii" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-4">
                <h3>Ce mod este activ?</h3>
                <p>IdentificÄƒ modul Ã®n care te afli Ã®n aceastÄƒ situaÈ›ie. Este un mod de copil vulnerabil, critic interior, sau poate adultul sÄƒnÄƒtos? ConÈ™tientizarea modului Ã®È›i poate oferi o mai bunÄƒ Ã®nÈ›elegere a reacÈ›iilor tale.</p>
                <textarea name="mod_activ" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-5">
                <h3>Ce comportament simÈ›i cÄƒ adopÈ›i?</h3>
                <p>Descrie comportamentul pe care Ã®l manifeÈ™ti Ã®n aceastÄƒ situaÈ›ie. Este un comportament de evitare, de confruntare, de sacrificiu de sine? RecunoaÈ™terea comportamentului te ajutÄƒ sÄƒ Ã®nÈ›elegi mai bine cum reacÈ›ionezi.</p>
                <textarea name="comportament" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-6">
                <h3>Care sunt nevoile tale mai profunde?</h3>
                <p>Ce nevoi stau la baza acestor emoÈ›ii È™i comportamente? Poate fi nevoia de siguranÈ›Äƒ, de validare, de acceptare? Identificarea acestor nevoi te poate ajuta sÄƒ gÄƒseÈ™ti strategii mai sÄƒnÄƒtoase pentru a le Ã®ndeplini.</p>
                <textarea name="nevoi_profunde" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-7">
                <h3>MÄƒ ajutÄƒ comportamentul meu sÄƒ Ã®ndeplinesc aceste nevoi?</h3>
                <p>ReflecteazÄƒ dacÄƒ felul Ã®n care reacÈ›ionezi te ajutÄƒ cu adevÄƒrat sÄƒ Ã®È›i Ã®ndeplineÈ™ti nevoile. Poate fi util sÄƒ te gÃ¢ndeÈ™ti dacÄƒ existÄƒ alternative mai eficiente.</p>
                <textarea name="ajutor_comportament" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-8">
                <h3>Cum ar gÃ¢ndi È™i cum s-ar comporta Adultul SÄƒnÄƒtos?</h3>
                <p>GÃ¢ndeÈ™te-te la cum ar reacÈ›iona partea ta AdultÄƒ SÄƒnÄƒtoasÄƒ Ã®n aceastÄƒ situaÈ›ie. Cum ai putea sÄƒ abordezi diferit pentru a avea grijÄƒ de tine È™i de nevoile tale?</p>
                <textarea name="adult_sanatos" rows="3" required></textarea>
            </div>

            <!-- SecÈ›iunea 2: Analiza gÃ¢ndurilor È™i a percepÈ›iilor -->
            <div class="question-card form-step" id="step-9">
                <h3>Ce mÄƒ face sÄƒ cred cÄƒ gÃ¢ndul automat este adevÄƒrat?</h3>
                <p>ExploreazÄƒ motivele pentru care crezi cÄƒ acest gÃ¢nd este adevÄƒrat. Ce dovezi ai care Ã®È›i confirmÄƒ acest lucru? De multe ori, ne bazÄƒm pe experienÈ›e trecute sau frici pentru a justifica un gÃ¢nd.</p>
                <textarea name="dovezi_adevar" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-10">
                <h3>Ce mÄƒ face sÄƒ cred cÄƒ nu este adevÄƒrat?</h3>
                <p>Acum, sÄƒ ne uitÄƒm la dovezile Ã®mpotriva gÃ¢ndului tÄƒu. ExistÄƒ argumente sau experienÈ›e care contrazic acest gÃ¢nd? Poate existÄƒ o altÄƒ perspectivÄƒ pe care nu ai luat-o Ã®n considerare?</p>
                <textarea name="dovezi_fals" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-11">
                <h3>ExistÄƒ o explicaÈ›ie alternativÄƒ?</h3>
                <p>Uneori, existÄƒ mai multe explicaÈ›ii pentru ceea ce se Ã®ntÃ¢mplÄƒ. Ce alte interpretÄƒri ai putea avea pentru aceastÄƒ situaÈ›ie? GÃ¢ndeÈ™te-te la alte posibilitÄƒÈ›i care ar putea explica contextul.</p>
                <textarea name="explicatie_alternativa" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-12">
                <h3>Care este cel mai rÄƒu lucru care s-ar putea Ã®ntÃ¢mpla?</h3>
                <p>Ce este cel mai rÄƒu care ar putea avea loc Ã®n aceastÄƒ situaÈ›ie? SÄƒ identificÄƒm acele frici catastrofale care adesea ne alimenteazÄƒ gÃ¢ndurile negative.</p>
                <textarea name="scenariu_negativ" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-13">
                <h3>Care este cel mai bun lucru care s-ar putea Ã®ntÃ¢mpla?</h3>
                <p>Pe de altÄƒ parte, care ar fi cel mai pozitiv scenariu? Uneori uitÄƒm sÄƒ ne gÃ¢ndim È™i la posibilitÄƒÈ›ile bune. Cum ar arÄƒta cel mai bun rezultat al acestei situaÈ›ii?</p>
                <textarea name="scenariu_optimist" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-14">
                <h3>Care este cel mai realist rezultat?</h3>
                <p>DupÄƒ ce am explorat extremele, ce crezi cÄƒ este cel mai probabil sÄƒ se Ã®ntÃ¢mple? Cum ar arÄƒta un rezultat realist, È›inÃ¢nd cont de toate perspectivele?</p>
                <textarea name="rezultat_realist" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-15">
                <h3>Ce s-ar Ã®ntÃ¢mpla dacÄƒ mi-aÈ™ schimba modul de gÃ¢ndire?</h3>
                <p>ÃntreabÄƒ-te cum ar fi dacÄƒ ai aborda situaÈ›ia cu un alt tip de gÃ¢ndire. Cum ar influenÈ›a asta emoÈ›iile È™i comportamentele tale?</p>
                <textarea name="schimbare_gandire" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-16">
                <h3>Ce i-aÈ™ spune unui prieten dacÄƒ ar fi Ã®n aceeaÈ™i situaÈ›ie?</h3>
                <p>GÃ¢ndeÈ™te-te la cum ai reacÈ›iona dacÄƒ un prieten drag ar avea aceleaÈ™i gÃ¢nduri. Ce i-ai spune pentru a-l sprijini? Cum ai Ã®ncerca sÄƒ-l Ã®ncurajezi?</p>
                <textarea name="sfat_prieten" rows="3" required></textarea>
            </div>

            <!-- SecÈ›iunea 3: ÃntrebÄƒri pentru claritate È™i reflecÈ›ie suplimentarÄƒ -->
            <div class="question-card form-step" id="step-17">
                <h3>VÄƒd doar partea rea a lucrurilor?</h3>
                <p>Este posibil sÄƒ fii prins Ã®ntr-un tipar negativ de gÃ¢ndire, concentrÃ¢ndu-te doar pe aspectele negative. ÃncearcÄƒ sÄƒ observi dacÄƒ existÄƒ È™i aspecte pozitive pe care le-ai ignorat.</p>
                <textarea name="partea_rea" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-18">
                <h3>Ãmi asum responsabilitatea pentru lucruri care nu au stat Ã®n puterea mea?</h3>
                <p>ReflecteazÄƒ dacÄƒ Ã®È›i asumi responsabilitatea pentru situaÈ›ii asupra cÄƒrora nu aveai control. Este important sÄƒ Ã®È›i dai seama de limitele influenÈ›ei tale.</p>
                <textarea name="responsabilitate" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-19">
                <h3>MÄƒ condamn Ã®n baza unui singur eveniment?</h3>
                <p>ÃÈ›i evaluezi valoarea personalÄƒ bazÃ¢ndu-te pe un singur eveniment negativ? AminteÈ™te-È›i cÄƒ un eveniment nu defineÈ™te cine eÈ™ti Ã®n totalitate.</p>
                <textarea name="condamnare" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-20">
                <h3>Privesc situaÈ›ia Ã®n termeni extremi?</h3>
                <p>VerificÄƒ dacÄƒ vezi situaÈ›ia doar Ã®n alb sau negru, fÄƒrÄƒ nuanÈ›e de gri. GÃ¢ndirea extremÄƒ poate distorsiona realitatea.</p>
                <textarea name="termeni_extremi" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-21">
                <h3>Exagerez situaÈ›ia?</h3>
                <p>ÃÈ›i amplifici reacÈ›iile faÈ›Äƒ de o situaÈ›ie? ÃncearcÄƒ sÄƒ te gÃ¢ndeÈ™ti dacÄƒ ceea ce percepi este realist sau dacÄƒ exagerezi impactul situaÈ›iei.</p>
                <textarea name="exagerare" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-22">
                <h3>ExistÄƒ È™i alÈ›i factori responsabili?</h3>
                <p>ExistÄƒ alÈ›i factori care contribuie la aceastÄƒ situaÈ›ie, pe lÃ¢ngÄƒ tine? Este important sÄƒ ai o perspectivÄƒ completÄƒ asupra cauzelor unei situaÈ›ii.</p>
                <textarea name="factori_responsabili" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-23">
                <h3>Am sÄƒrit direct la concluzii?</h3>
                <p>Te-ai grÄƒbit sÄƒ ajungi la o concluzie fÄƒrÄƒ suficiente dovezi? ÃncearcÄƒ sÄƒ observi dacÄƒ existÄƒ alte posibilitÄƒÈ›i care ar putea explica situaÈ›ia.</p>
                <textarea name="concluzii" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-24">
                <h3>Ãmi pun Ã®ntrebÄƒri fÄƒrÄƒ rÄƒspuns?</h3>
                <p>Te frÄƒmÃ¢ntÄƒ Ã®ntrebÄƒri care nu au un rÄƒspuns clar sau realist? Aceste Ã®ntrebÄƒri pot fi o sursÄƒ majorÄƒ de anxietate.</p>
                <textarea name="intrebari_fara_raspuns" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-25">
                <h3>MÄƒ concentrez doar asupra slÄƒbiciunilor mele?</h3>
                <p>Ai tendinÈ›a sÄƒ te focalizezi doar pe slÄƒbiciuni È™i sÄƒ ignori punctele tale forte? ÃncearcÄƒ sÄƒ Ã®È›i recunoÈ™ti È™i punctele pozitive.</p>
                <textarea name="slabiciuni" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-26">
                <h3>MÄƒ zbat prea mult gÃ¢ndind la cum ar trebui sÄƒ fie lucrurile?</h3>
                <p>Ai tendinÈ›a sÄƒ te gÃ¢ndeÈ™ti mereu la cum ar trebui sÄƒ fie lucrurile, Ã®n loc sÄƒ accepÈ›i situaÈ›ia aÈ™a cum este? Acceptarea poate reduce stresul È™i anxietatea.</p>
                <textarea name="cum_ar_trebui" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-27">
                <h3>MÄƒ aÈ™tept sÄƒ fiu perfect?</h3>
                <p>ÃÈ›i setezi standarde foarte Ã®nalte, imposibil de atins? PerfecÈ›ionismul poate fi o sursÄƒ majorÄƒ de frustrare È™i descurajare.</p>
                <textarea name="perfectiune" rows="3" required></textarea>
            </div>
            <div class="question-card form-step" id="step-28">
                <h3>Completare finalizata!</h3>
                <p>Nu uita sÄƒ salvezi datele.</p>
            </div>
            <div class="step-navigation">
                <button type="button" id="prevButton">Ãnapoi</button>
                <button type="button" id="nextButton">Ãnainte</button>
            </div>
            <button type="button" id="addButton">Salveaza datele</button> <!-- Acesta e butonul principal de salvare formular -->
        </form>

        <div id="confirmationMessage">
            <!-- Mesajul va fi setat de JavaScript -->
        </div>

        <div class="collaboration-section">
            <button type="button" id="generateLinkButton">GenereazÄƒ Link de Colaborare</button>
        </div>
    </div>
    
    <h3 style="text-align: center; margin-top: 40px; margin-bottom: 10px; color: #333; font-weight: 500;">RÄƒspunsurile tale È™i Feedback AI:</h3>
    
    <div class="card-view" id="cardViewContainer">
        <!-- Cardurile cu rÄƒspunsuri È™i feedback AI vor fi adÄƒugate aici de JavaScript -->
    </div>
    
    <div class="table-container" style="display: none;"> <!-- Ascuns implicit -->
        <table>
            <thead>
                <tr>
                    <th>Data</th><th>SituaÈ›ia</th><th>GÃ¢nduri</th><th>EmoÈ›ii</th><th>Mod activ</th>
                    <th>Comportament</th><th>Nevoile</th><th>Ajutor comport.</th><th>Adult SÄƒnÄƒtos</th><th>Detalii</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
    <br/>
    
</body>
</html>